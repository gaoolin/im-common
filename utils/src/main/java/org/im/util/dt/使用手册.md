# Chronos 时间处理工具类使用文档

## 1. 概述

Chronos 是一个专业的时间处理工具类，提供了丰富的时间操作功能，包括时间解析、格式化、计算、转换和比较等。该工具类基于 Java 8+ 的时间 API 设计，具备通用化、规范化、灵活性、容错性和专业性等特点。

## 2. 基本配置

### 2.1 默认时区

```
java
// 默认时区为 Asia/Shanghai
public static final String DEFAULT_TIMEZONE = "Asia/Shanghai";
```

### 2.2 预定义格式常量

```
java
// ISO 标准日期格式
public static final String ISO_DATE_FORMAT = "yyyy-MM-dd";
public static final String ISO_TIME_FORMAT = "HH:mm:ss";
public static final String ISO_DATETIME_FORMAT = "yyyy-MM-dd HH:mm:ss";
public static final String ISO_DATETIME_MS_FORMAT = "yyyy-MM-dd HH:mm:ss.SSS";

// 紧凑型日期格式
public static final String COMPACT_DATE_FORMAT = "yyyyMMdd";
public static final String COMPACT_DATETIME_FORMAT = "yyyyMMddHHmmss";
public static final String COMPACT_DATETIME_MS_FORMAT = "yyyyMMddHHmmssSSS";
```

## 3. 核心功能

### 3.1 获取时间格式化器

```
java
// 获取指定格式的 DateTimeFormatter（带缓存）
DateTimeFormatter formatter = Chronos.getFormatter("yyyy-MM-dd HH:mm:ss");

// 预定义格式化器可以直接使用常量
DateTimeFormatter isoFormatter = Chronos.getFormatter(Chronos.ISO_DATETIME_FORMAT);
```

### 3.2 时区处理

```
java
// 获取默认时区
ZoneId defaultZone = Chronos.getDefaultZoneId();

// 获取指定时区（带容错处理）
ZoneId zone = Chronos.getZoneId("America/New_York");
```

### 3.3 当前时间获取

```
java
// 获取当前时间戳
long timestamp = Chronos.currentTimestamp();

// 获取当前 LocalDateTime
LocalDateTime now = Chronos.now();

// 获取指定时区的当前时间
ZonedDateTime zonedNow = Chronos.now("America/New_York");
```

## 4. 时间解析功能

### 4.1 解析日期 (LocalDate)

```
java
// 使用默认格式解析
LocalDate date1 = Chronos.parseDate("2025-08-20");

// 使用自定义格式解析
LocalDate date2 = Chronos.parseDate("20250820", Chronos.COMPACT_DATE_FORMAT);

// 解析失败返回 null，具备容错性
LocalDate date3 = Chronos.parseDate("invalid-date"); // 返回 null
```

### 4.2 解析时间 (LocalTime)

```
java
// 使用默认格式解析
LocalTime time1 = Chronos.parseTime("14:30:00");

// 使用自定义格式解析
LocalTime time2 = Chronos.parseTime("143000", "HHmmss");
```

### 4.3 解析日期时间 (LocalDateTime)

```
java
// 使用默认格式解析
LocalDateTime dateTime1 = Chronos.parseDateTime("2025-08-20 14:30:00");

// 使用自定义格式解析
LocalDateTime dateTime2 = Chronos.parseDateTime("20250820143000", Chronos.COMPACT_DATETIME_FORMAT);
```

### 4.4 解析带时区的日期时间 (ZonedDateTime)

```
java
// 解析带时区的日期时间
ZonedDateTime zonedDateTime = Chronos.parseZonedDateTime("2025-08-20 14:30:00", 
                                                         Chronos.ISO_DATETIME_FORMAT, 
                                                         "America/New_York");
```

## 5. 时间格式化功能

### 5.1 格式化时间对象

```
java
LocalDateTime now = LocalDateTime.now();

// 使用默认格式格式化
String formatted1 = Chronos.format(now); // "2025-08-20 14:30:00"

// 使用自定义格式格式化
String formatted2 = Chronos.format(now, "yyyy/MM/dd HH:mm"); // "2025/08/20 14:30"
```

## 6. 时间戳转换

### 6.1 时间戳转时间对象

```
java
long timestamp = System.currentTimeMillis();

// 转换为 LocalDateTime
LocalDateTime dateTime = Chronos.fromTimestamp(timestamp);

// 转换为 ZonedDateTime（指定时区）
ZonedDateTime zonedDateTime = Chronos.fromTimestamp(timestamp, "America/New_York");
```

### 6.2 时间对象转时间戳

```
java
LocalDateTime dateTime = LocalDateTime.now();

// 转换为时间戳
long timestamp = Chronos.toTimestamp(dateTime);
```

## 7. 时间计算功能

### 7.1 时间差计算

```
java
LocalDate start = LocalDate.of(2025, 1, 1);
LocalDate end = LocalDate.of(2025, 12, 31);

// 计算天数差
long days = Chronos.daysBetween(start, end); // 364

LocalDateTime startDateTime = LocalDateTime.of(2025, 1, 1, 10, 0);
LocalDateTime endDateTime = LocalDateTime.of(2025, 1, 1, 15, 30);

// 计算小时差
long hours = Chronos.hoursBetween(startDateTime, endDateTime); // 5

// 计算分钟差
long minutes = Chronos.minutesBetween(startDateTime, endDateTime); // 330
```

### 7.2 日期边界计算

```
java
LocalDate date = LocalDate.of(2025, 8, 20);

// 获取当天开始时间 (00:00:00)
LocalDateTime startOfDay = Chronos.startOfDay(date);

// 获取当天结束时间 (23:59:59.999999999)
LocalDateTime endOfDay = Chronos.endOfDay(date);

// 获取月份第一天
LocalDate firstDayOfMonth = Chronos.firstDayOfMonth(date); // 2025-08-01

// 获取月份最后一天
LocalDate lastDayOfMonth = Chronos.lastDayOfMonth(date); // 2025-08-31

// 获取年份第一天
LocalDate firstDayOfYear = Chronos.firstDayOfYear(date); // 2025-01-01

// 获取年份最后一天
LocalDate lastDayOfYear = Chronos.lastDayOfYear(date); // 2025-12-31
```

### 7.3 时间加减运算

```
java
LocalDate date = LocalDate.of(2025, 8, 20);
LocalDateTime dateTime = LocalDateTime.of(2025, 8, 20, 14, 30, 0);

// 日期加减天数
LocalDate newDate1 = Chronos.addDays(date, 10);  // 加10天
LocalDate newDate2 = Chronos.addDays(date, -5);  // 减5天

// 日期加减月数
LocalDate newDate3 = Chronos.addMonths(date, 2); // 加2个月

// 日期加减年数
LocalDate newDate4 = Chronos.addYears(date, 1);  // 加1年

// 日期时间加减小时
LocalDateTime newDateTime1 = Chronos.addHours(dateTime, 3); // 加3小时

// 日期时间加减分钟
LocalDateTime newDateTime2 = Chronos.addMinutes(dateTime, 30); // 加30分钟

// 日期时间加减秒数
LocalDateTime newDateTime3 = Chronos.addSeconds(dateTime, 45); // 加45秒
```

## 8. 时间查询功能

### 8.1 闰年判断

```
java
// 判断是否为闰年
boolean isLeap = Chronos.isLeapYear(2024); // true
```

### 8.2 天数查询

```
java
// 获取指定年份的总天数
int daysInYear = Chronos.lengthOfYear(2024); // 366

// 获取指定年月的总天数
int daysInMonth = Chronos.lengthOfMonth(2025, 2); // 28
```

### 8.3 时间段重叠判断

```
java
LocalDateTime start1 = LocalDateTime.of(2025, 1, 1, 10, 0);
LocalDateTime end1 = LocalDateTime.of(2025, 1, 1, 12, 0);
LocalDateTime start2 = LocalDateTime.of(2025, 1, 1, 11, 0);
LocalDateTime end2 = LocalDateTime.of(2025, 1, 1, 13, 0);

// 判断两个时间段是否有重叠
boolean overlap = Chronos.isOverlap(start1, end1, start2, end2); // true
```

## 9. 时间比较功能

### 9.1 时间先后比较

```
java
LocalDateTime time1 = Chronos.parseDateTime("2025-08-20 10:00:00");
LocalDateTime time2 = Chronos.parseDateTime("2025-08-20 14:00:00");

// 比较两个时间的先后
int result = Chronos.compare(time1, time2); // 返回负数，表示time1早于time2

// 判断时间先后关系
boolean isBefore = Chronos.isBefore(time1, time2); // true
boolean isAfter = Chronos.isAfter(time1, time2);   // false
boolean isEqual = Chronos.isEqual(time1, time2);   // false
```

### 9.2 日期比较

```
java
LocalDate date1 = Chronos.parseDate("2025-08-20");
LocalDate date2 = Chronos.parseDate("2025-08-25");

// 比较两个日期的先后
int result = Chronos.compare(date1, date2); // 返回负数，表示date1早于date2

// 判断日期先后关系
boolean isBefore = Chronos.isBefore(date1, date2); // true
boolean isAfter = Chronos.isAfter(date1, date2);   // false
```

### 9.3 带时区时间比较

```
java
ZonedDateTime time1 = Chronos.parseZonedDateTime("2025-08-20 10:00:00", 
                                                 Chronos.ISO_DATETIME_FORMAT, 
                                                 "Asia/Shanghai");
ZonedDateTime time2 = Chronos.parseZonedDateTime("2025-08-20 10:00:00", 
                                                 Chronos.ISO_DATETIME_FORMAT, 
                                                 "America/New_York");

// 比较两个带时区时间的先后
int result = Chronos.compare(time1, time2); // 根据实际时区计算结果

// 判断时间先后关系
boolean isBefore = Chronos.isBefore(time1, time2); // 根据实际时区计算结果
boolean isAfter = Chronos.isAfter(time1, time2);   // 根据实际时区计算结果
```

### 9.4 时间范围判断

```
java
LocalDateTime time = Chronos.parseDateTime("2025-08-20 12:00:00");
LocalDateTime start = Chronos.parseDateTime("2025-08-20 10:00:00");
LocalDateTime end = Chronos.parseDateTime("2025-08-20 14:00:00");

// 判断时间是否在指定范围内（包含边界）
boolean isBetween = Chronos.isBetween(time, start, end); // true

LocalDate date = Chronos.parseDate("2025-08-20");
LocalDate startDate = Chronos.parseDate("2025-08-15");
LocalDate endDate = Chronos.parseDate("2025-08-25");

// 判断日期是否在指定范围内（包含边界）
boolean dateIsBetween = Chronos.isBetween(date, startDate, endDate); // true
```

## 10. 使用示例

### 10.1 基本时间处理

```
java
// 获取当前时间并格式化
String nowStr = Chronos.format(Chronos.now());
System.out.println("当前时间: " + nowStr);

// 解析用户输入的日期
LocalDate userDate = Chronos.parseDate("2025-08-20");
if (userDate != null) {
    System.out.println("解析成功: " + userDate);
} else {
    System.out.println("日期格式错误");
}
```

### 10.2 时间计算示例

```
java
// 计算两个日期之间的天数差
LocalDate startDate = Chronos.parseDate("2025-01-01");
LocalDate endDate = Chronos.parseDate("2025-12-31");
long days = Chronos.daysBetween(startDate, endDate);
System.out.println("相差天数: " + days);

// 计算工作日（示例）
LocalDate workStart = Chronos.parseDate("2025-08-01");
LocalDate workEnd = Chronos.addDays(workStart, 10);
System.out.println("工作结束日期: " + workEnd);
```

### 10.3 时间戳处理示例

```
java
// 将时间戳转换为可读格式
long timestamp = System.currentTimeMillis();
LocalDateTime dateTime = Chronos.fromTimestamp(timestamp);
String readableTime = Chronos.format(dateTime, Chronos.ISO_DATETIME_FORMAT);
System.out.println("时间戳对应时间: " + readableTime);
```

### 10.4 时间比较示例

```
java
LocalDateTime now = Chronos.now();
LocalDateTime tomorrow = Chronos.addDays(now, 1);
LocalDateTime yesterday = Chronos.addDays(now, -1);

// 时间先后判断
if (Chronos.isBefore(yesterday, now)) {
    System.out.println("昨天在现在之前");
}

if (Chronos.isBetween(now, yesterday, tomorrow)) {
    System.out.println("现在在昨天和明天之间");
}

// 查找最早和最晚的时间
LocalDateTime[] times = {now, tomorrow, yesterday};
LocalDateTime earliest = times[0];
LocalDateTime latest = times[0];

for (LocalDateTime time : times) {
    if (Chronos.isBefore(time, earliest)) {
        earliest = time;
    }
    if (Chronos.isAfter(time, latest)) {
        latest = time;
    }
}

System.out.println("最早时间: " + Chronos.format(earliest));
System.out.println("最晚时间: " + Chronos.format(latest));
```

## 11. 异常处理与容错

Chronos 工具类具备良好的容错性：

- 所有解析方法在失败时返回 `null` 而不是抛出异常
- 提供详细的日志记录
- 输入参数校验，避免空指针异常
- 时区处理具备默认值回退机制
- 时间比较方法对null值进行了妥善处理

```
java
// 容错示例
LocalDate invalidDate = Chronos.parseDate("invalid-format");
if (invalidDate == null) {
    // 处理解析失败的情况
    System.out.println("日期解析失败，使用默认值");
}

// 时间比较容错处理
LocalDateTime time1 = null;
LocalDateTime time2 = Chronos.now();
boolean isBefore = Chronos.isBefore(time1, time2); // false，不会抛出异常
int compareResult = Chronos.compare(time1, time2); // -1，正确处理null值
```

## 12. 性能优化

- 使用 `ConcurrentHashMap` 缓存 `DateTimeFormatter` 实例
- 预定义常用格式化器，避免重复创建
- 合理使用 `ZoneId` 缓存机制

## 13. 最佳实践

1. **优先使用预定义格式常量**：避免硬编码格式字符串
2. **合理处理返回值**：检查可能返回 `null` 的方法
3. **时区处理**：明确指定时区，避免依赖系统默认时区
4. **时间计算**：使用提供的计算方法而非手动计算
5. **日志记录**：关注工具类输出的警告日志，及时发现潜在问题
6. **时间比较**：使用专门的比较方法，提高代码可读性
7. **边界检查**：使用[isBetween](file://E:\dossier\others\im-common\src\main\java\com\qtech\im\util\dt\Chronos.java#L803-L808)方法进行时间范围判断

这个文档涵盖了 Chronos 时间处理工具类的主要功能和使用方法，可以帮助开发者快速上手并正确使用该工具类。

```
