# 半导体框架上下文信息接口使用最佳实践指南

## 概述

本文档旨在指导开发者如何有效地使用 `org.im.semiconductor.common.context` 包中的各类信息接口，包括 [DeviceInfo](file://E:\dossier\others\im-framework\semiconductor\src\main\java\org\im\semiconductor\common\context\equipment\DeviceInfo.java#L18-L154)、[LocationInfo](file://E:\dossier\others\im-framework\semiconductor\src\main\java\org\im\semiconductor\common\context\location\LocationInfo.java#L16-L192) 等，以构建高效、可维护的应用程序。

## 核心设计理念

### 统一接口规范
- 所有上下文信息接口遵循统一设计模式
- 提供标准方法：[isValid()](file://E:\dossier\others\im-framework\config\src\main\java\org\im\config\ConfigProperty.java#L47-L47)、[hasRequiredFields()](file://E:\dossier\others\im-framework\qtech\datadev\datadev-common\src\main\java\com\im\qtech\data\dto\net\EqpNetworkStatus.java#L309-L312)、[getValidationErrors()](file://E:\dossier\others\im-framework\qtech\datadev\datadev-common\src\main\java\com\im\qtech\data\dto\net\EqpNetworkStatus.java#L319-L322)
- 支持多种数据格式转换：[toJson()](file://E:\dossier\others\im-framework\qtech\datadev\datadev-common\src\main\java\com\im\qtech\data\dto\net\EqpNetworkStatus.java#L329-L332)、[toMap()](file://E:\dossier\others\im-framework\qtech\datadev\datadev-common\src\main\java\com\im\qtech\data\dto\net\EqpNetworkStatus.java#L339-L342)

### 按需使用原则
尽管接口定义了完整的属性集，但实际应用中应根据需求灵活提取所需信息。

## 最佳实践案例

### 1. 创建专用数据传输对象(DTO)

当只需要部分属性时，创建轻量级DTO：

```java
public class EquipmentLocationSummary {
    private String deviceId;
    private String deviceName;
    private String companyName;
    private String siteName;
    private String workshopName;
    
    public EquipmentLocationSummary(DeviceInfo deviceInfo, LocationInfo locationInfo) {
        this.deviceId = deviceInfo.getDeviceId();
        this.deviceName = deviceInfo.getDeviceName();
        this.companyName = locationInfo.getCompany();
        this.siteName = locationInfo.getSite();
        this.workshopName = locationInfo.getWorkshop();
    }
    
    // getters and setters...
}
```


### 2. 利用现有转换功能

使用 [toMap()](file://E:\dossier\others\im-framework\qtech\datadev\datadev-common\src\main\java\com\im\qtech\data\dto\net\EqpNetworkStatus.java#L339-L342) 方法提取所需字段：

```java
@Service
public class ReportDataService {
    
    public List<Map<String, Object>> generateEquipmentReport(List<DeviceInfo> devices) {
        return devices.stream()
            .filter(DeviceInfo::isValid)
            .map(this::extractRequiredFields)
            .collect(Collectors.toList());
    }
    
    private Map<String, Object> extractRequiredFields(DeviceInfo deviceInfo) {
        Map<String, Object> deviceMap = deviceInfo.toMap();
        Map<String, Object> filteredMap = new HashMap<>();
        
        // 只保留需要的字段
        filteredMap.put("deviceId", deviceMap.get("deviceId"));
        filteredMap.put("deviceName", deviceMap.get("deviceName"));
        filteredMap.put("deviceType", deviceMap.get("deviceType"));
        filteredMap.put("deviceStatus", deviceMap.get("deviceStatus"));
        
        return filteredMap;
    }
}
```


### 3. 创建组合视图接口

为特定业务场景创建组合视图：

```java
public interface EquipmentLocationView {
    String getDeviceId();
    String getDeviceName();
    String getCompany();
    String getSite();
    String getWorkshop();
    String getDeviceStatus();
}

@Component
public class EquipmentLocationViewAdapter implements EquipmentLocationView {
    private final DeviceInfo deviceInfo;
    private final LocationInfo locationInfo;
    
    public EquipmentLocationViewAdapter(DeviceInfo deviceInfo, LocationInfo locationInfo) {
        this.deviceInfo = deviceInfo;
        this.locationInfo = locationInfo;
    }
    
    @Override
    public String getDeviceId() { return deviceInfo.getDeviceId(); }
    
    @Override
    public String getDeviceName() { return deviceInfo.getDeviceName(); }
    
    @Override
    public String getCompany() { return locationInfo.getCompany(); }
    
    @Override
    public String getSite() { return locationInfo.getSite(); }
    
    @Override
    public String getWorkshop() { return locationInfo.getWorkshop(); }
    
    @Override
    public String getDeviceStatus() { return deviceInfo.getDeviceStatus(); }
}
```


### 4. 报表生成服务示例

完整的报表服务实现：

```java
@Service
public class EquipmentReportService {
    
    public EquipmentReportData generateEquipmentLocationReport(DeviceInfo deviceInfo, LocationInfo locationInfo) {
        // 验证数据完整性
        if (!validateInputs(deviceInfo, locationInfo)) {
            throw new IllegalArgumentException("Invalid input data for report generation");
        }
        
        EquipmentReportData reportData = new EquipmentReportData();
        
        // 设备信息
        reportData.setDeviceId(deviceInfo.getDeviceId());
        reportData.setDeviceName(deviceInfo.getDeviceName());
        reportData.setDeviceType(deviceInfo.getDeviceType());
        reportData.setDeviceStatus(deviceInfo.getDeviceStatus());
        
        // 位置信息
        reportData.setCompanyName(locationInfo.getCompany());
        reportData.setSiteName(locationInfo.getSite());
        reportData.setWorkshopName(locationInfo.getWorkshop());
        reportData.setFullLocation(locationInfo.getFullLocation());
        
        return reportData;
    }
    
    private boolean validateInputs(DeviceInfo deviceInfo, LocationInfo locationInfo) {
        return deviceInfo != null && deviceInfo.isValid() && 
               locationInfo != null && locationInfo.isValid();
    }
}
```


### 5. 控制器层使用示例

```java
@RestController
@RequestMapping("/api/reports")
public class ReportController {
    
    @Autowired
    private EquipmentReportService equipmentReportService;
    
    @GetMapping("/equipment-location")
    public ResponseEntity<List<EquipmentReportData>> getEquipmentLocationReport() {
        // 获取数据源
        List<Pair<DeviceInfo, LocationInfo>> equipmentLocations = getDataFromRepository();
        
        List<EquipmentReportData> reports = equipmentLocations.stream()
            .map(pair -> equipmentReportService.generateEquipmentLocationReport(
                pair.getLeft(), pair.getRight()))
            .collect(Collectors.toList());
            
        return ResponseEntity.ok(reports);
    }
    
    private List<Pair<DeviceInfo, LocationInfo>> getDataFromRepository() {
        // 从数据仓库获取设备和位置信息对
        return Collections.emptyList();
    }
}
```


## 数据验证最佳实践

充分利用接口提供的验证功能：

```java
public class DataValidationUtil {
    
    public static void validateAndProcess(List<DeviceInfo> devices) {
        devices.forEach(device -> {
            if (!device.hasRequiredFields()) {
                log.warn("Device missing required fields: {}", device.getValidationErrors());
                return;
            }
            
            if (!device.isValid()) {
                log.error("Invalid device data: {}", device.getValidationErrors());
                return;
            }
            
            // 处理有效的设备数据
            processValidDevice(device);
        });
    }
    
    private static void processValidDevice(DeviceInfo device) {
        // 实际业务处理逻辑
        System.out.println("Processing device: " + device.getDeviceName());
    }
}
```


## 性能优化建议

### 1. 批量处理
```java
// 推荐：批量处理
List<EquipmentReportData> reports = deviceInfos.stream()
    .filter(DeviceInfo::isValid)
    .map(this::convertToDeviceReport)
    .collect(Collectors.toList());

// 不推荐：逐个处理（性能较差）
for (DeviceInfo deviceInfo : deviceInfos) {
    if (deviceInfo.isValid()) {
        EquipmentReportData report = convertToDeviceReport(deviceInfo);
        // 逐一处理
    }
}
```


### 2. 缓存转换结果
对于频繁使用的数据，考虑缓存转换结果以提高性能。

## 错误处理策略

```java
public class ReportGenerationExceptionHandler {
    
    public ReportResult generateReportSafely(List<DeviceInfo> devices) {
        List<EquipmentReportData> validReports = new ArrayList<>();
        List<String> errors = new ArrayList<>();
        
        for (DeviceInfo device : devices) {
            try {
                if (device.isValid()) {
                    EquipmentReportData report = convertToDeviceReport(device);
                    validReports.add(report);
                } else {
                    errors.addAll(device.getValidationErrors());
                }
            } catch (Exception e) {
                errors.add("Error processing device " + device.getDeviceId() + ": " + e.getMessage());
            }
        }
        
        return new ReportResult(validReports, errors);
    }
}
```


## 总结

通过以上最佳实践，开发者可以：
- 高效利用现有的上下文信息接口
- 根据实际需求灵活提取数据
- 保证代码的可维护性和扩展性
- 充分发挥接口提供的验证和转换功能
- 构建健壮且高性能的应用程序