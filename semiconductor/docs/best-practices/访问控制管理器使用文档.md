# AccessController 使用说明文档

## 1. 概述

[AccessController](file://E:\dossier\others\im-common\src\main\java\com\qtech\im\semiconductor\security\AccessController.java#L30-L582)
是一个专业的访问控制管理器，用于处理用户身份验证、权限控制、会话管理和安全审计等安全相关功能。该工具提供了完整的安全解决方案，能够有效保护系统资源不被未授权访问。

## 2. 核心功能

### 2.1 用户身份验证

- 支持用户名/密码认证
- 账户锁定机制（防暴力破解）
- 密码强度验证
- 会话管理

### 2.2 权限控制

- 基于角色的访问控制（RBAC）
- 细粒度权限检查
- 资源级权限管理

### 2.3 安全审计

- 操作日志记录
- 安全事件追踪
- 合规性报告

### 2.4 数据保护

- 敏感数据加密
- 密码哈希存储
- 安全配置管理

## 3. 基本使用方法

### 3.1 用户认证

```java
// 用户登录认证
String username = "john_doe";
String password = "SecurePass123!";
String ipAddress = "192.168.1.100";

AccessController.AuthenticationResult result = 
    AccessController.authenticateUser(username, password, ipAddress);

if (result.isSuccess()) {
    System.out.println("认证成功!");
    System.out.println("用户ID: " + result.getUserId());
    System.out.println("会话ID: " + result.getSessionId());
} else {
    System.err.println("认证失败: " + result.getMessage());
}
```

### 3.2 权限检查

```java
// 检查用户权限
String sessionId = result.getSessionId(); // 从认证结果获取
String resource = "/api/users";
AccessController.PermissionType permission = AccessController.PermissionType.READ;

AccessController.PermissionCheckResult permissionResult = 
    AccessController.checkPermission(sessionId, resource, permission);

if (permissionResult.isGranted()) {
    System.out.println("权限检查通过");
    // 执行受保护的操作
} else {
    System.err.println("权限不足: " + permissionResult.getMessage());
    // 拒绝访问
}
```

## 4. 用户管理

### 4.1 创建用户

```java
// 创建新用户
String userId = "user123";
String username = "jane_smith";
String password = "MySecurePassword1@";

boolean created = AccessController.createUser(userId, username, password);

if (created) {
    System.out.println("用户创建成功: " + username);
} else {
    System.err.println("用户创建失败");
}
```

### 4.2 账户锁定/解锁

```java
// 锁定用户账户
boolean locked = AccessController.lockUserAccount("jane_smith");
if (locked) {
    System.out.println("账户已锁定");
}

// 解锁用户账户
boolean unlocked = AccessController.unlockUserAccount("jane_sm");
if (unlocked) {
    System.out.println("账户已解锁");
}
```

## 5. 安全配置

### 5.1 配置安全参数

```java
// 自定义安全配置
AccessController.SecurityConfig config = new AccessController.SecurityConfig()
    .setHashAlgorithm("SHA-512")                    // 设置密码哈希算法
    .setEncryptionAlgorithm("AES")                  // 设置加密算法
    .setKeySize(256)                                // 设置密钥长度
    .setSessionTimeout(60 * 60 * 1000)             // 设置会话超时时间（1小时）
    .setMaxLoginAttempts(3)                         // 设置最大登录尝试次数
    .setLockoutDuration(60 * 60 * 1000)            // 设置锁定时间（1小时）
    .setEnableAuditLogging(true)                    // 启用审计日志
    .setEnableSessionManagement(true)              // 启用会话管理
    .setEnablePasswordPolicy(true);                // 启用密码策略

// 更新安全配置
AccessController.updateSecurityConfig(config);
```

## 6. 数据安全保护

### 6.1 敏感数据加密

```java
// 加密敏感数据
String sensitiveData = "This is confidential information";
AccessController.EncryptedData encryptedData = 
    AccessController.encryptSensitiveData(sensitiveData);

if (encryptedData != null) {
    System.out.println("数据加密成功");
    System.out.println("算法: " + encryptedData.getAlgorithm());
    System.out.println("数据大小: " + encryptedData.getEncryptedBytes().length + " 字节");
}
```

### 6.2 密码处理

```java
// 密码哈希
String password = "user_password";
String hashedPassword = AccessController.hashPassword(password);
System.out.println("哈希密码: " + hashedPassword);

// 密码强度验证
boolean isStrong = AccessController.validatePasswordStrength(password);
if (isStrong) {
    System.out.println("密码强度符合要求");
} else {
    System.err.println("密码强度不足");
}
```

## 7. 审计日志

### 7.1 操作日志记录

```java
// 记录操作日志
String userId = "user123";
String operation = "UPDATE_USER";
String resource = "/api/users/456";
String details = "Updated user profile";
String ipAddress = "192.168.1.100";
boolean success = true;

boolean logged = AccessController.recordOperation(
    userId, operation, resource, details, ipAddress, success);

if (logged) {
    System.out.println("操作日志记录成功");
}
```

### 7.2 查看审计日志

```java
// 获取审计日志
List<AccessController.AuditLog> logs = AccessController.getAuditLogs(50); // 获取最近50条

for (AccessController.AuditLog log : logs) {
    System.out.println("时间: " + new Date(log.getTimestamp()));
    System.out.println("用户: " + log.getUserId());
    System.out.println("操作: " + log.getOperation());
    System.out.println("资源: " + log.getResource());
    System.out.println("IP地址: " + log.getIpAddress());
    System.out.println("成功: " + log.isSuccess());
    System.out.println("详情: " + log.getDetails());
    System.out.println("---");
}
```

## 8. 高级使用示例

### 8.1 完整的认证和授权流程

```java
public class SecureService {
    public void secureOperation(String username, String password, String ipAddress) {
        try {
            // 1. 用户认证
            AccessController.AuthenticationResult authResult = 
                AccessController.authenticateUser(username, password, ipAddress);
            
            if (!authResult.isSuccess()) {
                System.err.println("认证失败: " + authResult.getMessage());
                return;
            }
            
            // 2. 权限检查
            String sessionId = authResult.getSessionId();
            String resource = "/secure/resource";
            AccessController.PermissionType permission = AccessController.PermissionType.READ;
            
            AccessController.PermissionCheckResult permResult = 
                AccessController.checkPermission(sessionId, resource, permission);
            
            if (!permResult.isGranted()) {
                System.err.println("权限不足: " + permResult.getMessage());
                return;
            }
            
            // 3. 执行安全操作
            performSecureOperation();
            
            // 4. 记录操作日志
            AccessController.recordOperation(
                authResult.getUserId(), 
                "SECURE_OPERATION", 
                resource, 
                "Operation completed successfully", 
                ipAddress, 
                true
            );
            
            System.out.println("安全操作执行成功");
            
        } catch (Exception e) {
            System.err.println("安全操作执行失败: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    private void performSecureOperation() {
        // 执行需要保护的业务逻辑
        System.out.println("执行受保护的操作...");
    }
}
```

### 8.2 用户角色管理

```java
public class UserRoleManager {
    public void assignRole(String username, String role) {
        AccessController.User user = getUserFromStore(username); // 假设从存储中获取用户
        if (user != null) {
            user.addRole(role);
            System.out.println("角色 " + role + " 已分配给用户 " + username);
        } else {
            System.err.println("用户不存在: " + username);
        }
    }
    
    public void checkUserRole(String username, String requiredRole) {
        AccessController.User user = getUserFromStore(username);
        if (user != null && user.getRoles().contains(requiredRole)) {
            System.out.println("用户 " + username + " 拥有角色 " + requiredRole);
        } else {
            System.err.println("用户 " + username + " 缺少角色 " + requiredRole);
        }
    }
    
    private AccessController.User getUserFromStore(String username) {
        // 实际实现中应从数据库或其他存储中获取用户
        return null; // 示例返回null
    }
}
```

## 9. 权限类型说明

```java
public enum PermissionType {
    READ("读取权限"),
    WRITE("写入权限"),
    EXECUTE("执行权限"),
    ADMIN("管理权限");
}
```

## 10. 安全最佳实践

### 10.1 密码安全

```java
// 创建强密码的示例
public class PasswordUtils {
    public static boolean isValidPassword(String password) {
        // 使用AccessController的密码强度验证
        return AccessController.validatePasswordStrength(password);
    }
    
    public static String generateStrongPassword() {
        // 生成符合强度要求的密码
        String upper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        String lower = "abcdefghijklmnopqrstuvwxyz";
        String digits = "0123456789";
        String special = "!@#$%^&*()_+-=[]{}|;:,.<>?";
        
        StringBuilder password = new StringBuilder();
        Random random = new Random();
        
        // 确保包含各类字符
        password.append(upper.charAt(random.nextInt(upper.length())));
        password.append(lower.charAt(random.nextInt(lower.length())));
        password.append(digits.charAt(random.nextInt(digits.length())));
        password.append(special.charAt(random.nextInt(special.length())));
        
        // 添加随机字符达到最小长度
        String allChars = upper + lower + digits + special;
        for (int i = 4; i < AccessController.MIN_PASSWORD_LENGTH; i++) {
            password.append(allChars.charAt(random.nextInt(allChars.length())));
        }
        
        return password.toString();
    }
}
```

### 10.2 会话管理

```java
public class SessionManager {
    public void validateSession(String sessionId) {
        // 在每个请求中验证会话
        // 这里可以集成到Web框架的拦截器中
    }
    
    public void cleanupSessions() {
        // 定期清理过期会话
        // AccessController内部已自动处理
    }
}
```

## 11. 配置参数详解

### 11.1 默认配置值

```java
// 默认配置参数
public static final String DEFAULT_HASH_ALGORITHM = "SHA-256";
public static final String DEFAULT_ENCRYPTION_ALGORITHM = "AES";
public static final int DEFAULT_KEY_SIZE = 256;
public static final long DEFAULT_SESSION_TIMEOUT = 30 * 60 * 1000; // 30分钟
public static final int MIN_PASSWORD_LENGTH = 8;
public static final int MAX_LOGIN_ATTEMPTS = 5;
public static final long LOCKOUT_DURATION = 30 * 60 * 1000; // 30分钟
```

## 12. 错误处理

### 12.1 认证错误处理

```java
public class AuthenticationHandler {
    public void handleAuthentication(String username, String password, String ipAddress) {
        AccessController.AuthenticationResult result = 
            AccessController.authenticateUser(username, password, ipAddress);
        
        switch (result.getMessage()) {
            case "Invalid username or password":
                System.err.println("用户名或密码错误");
                break;
            case "Account is locked":
                System.err.println("账户已被锁定，请稍后再试");
                break;
            case "Account is administratively locked":
                System.err.println("账户被管理员锁定，请联系管理员");
                break;
            default:
                if (result.isSuccess()) {
                    System.out.println("认证成功");
                } else {
                    System.err.println("认证失败: " + result.getMessage());
                }
        }
    }
}
```

## 13. 系统集成

### 13.1 Web应用集成示例

```java
// 在Web应用中集成AccessController
public class WebSecurityFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        // 获取会话ID
        String sessionId = httpRequest.getHeader("Authorization");
        if (sessionId == null || sessionId.isEmpty()) {
            sessionId = httpRequest.getParameter("sessionId");
        }
        
        // 检查权限（示例：保护/api/secure路径）
        String requestURI = httpRequest.getRequestURI();
        if (requestURI.startsWith("/api/secure")) {
            AccessController.PermissionCheckResult result = 
                AccessController.checkPermission(sessionId, requestURI, 
                                               AccessController.PermissionType.READ);
            
            if (!result.isGranted()) {
                httpResponse.setStatus(HttpServletResponse.SC_FORBIDDEN);
                httpResponse.getWriter().write("Access Denied: " + result.getMessage());
                return;
            }
        }
        
        chain.doFilter(request, response);
    }
}
```

## 14. 关闭安全管理器

```java
// 应用关闭时调用
public class ApplicationShutdown {
    public static void main(String[] args) {
        // 应用逻辑...
        
        // 关闭时清理资源
        Runtime.getRuntime().addShutdownHook(new Thread(() -> {
            AccessController.shutdown();
            System.out.println("安全管理器已关闭");
        }));
    }
}
```

这个使用说明文档涵盖了 [AccessController](file://E:\dossier\others\im-common\src\main\java\com\qtech\im\semiconductor\security\AccessController.java#L30-L582)
的主要功能和使用方法，可以帮助开发者快速上手并正确使用该安全工具类。