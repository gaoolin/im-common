# ProductSerializer 使用说明文档

## 1. 概述

[ProductSerializer](file://E:\dossier\others\im-common\src\main\java\com\qtech\im\semiconductor\product\ProductSerializer.java#L34-L950)
是一个专业的半导体产品序列化管理工具类，专门用于半导体封测行业的产品标识生成、信息管理、状态更新和全程追溯。该工具解决了产品标识不统一、产品信息管理分散、产品追溯链条不完整和产品状态更新不及时等问题。

## 2. 核心功能

### 2.1 产品唯一标识生成

- 支持多种序列号生成策略（时间戳、序列、UUID、哈希等）
- 可配置的序列号格式和规则
- 自动生成符合行业标准的产品标识

### 2.2 产品信息管理

- 完整的产品信息生命周期管理
- 产品属性和元数据管理
- 产品状态历史记录

### 2.3 产品状态更新

- 状态变更验证和控制
- 状态变更日志记录
- 实时状态同步

### 2.4 产品全程追溯

- 完整的产品生命周期追溯
- 多维度追溯事件记录
- 追溯信息查询和分析

## 3. 支持的产品类型和状态

### 3.1 产品类型

```java
public enum ProductType {
    WIRE_BONDING("WB", "引线键合产品"),     // 引线键合封装产品
    FLIP_CHIP("FC", "倒装芯片产品"),       // 倒装芯片封装产品
    BGA("BGA", "球栅阵列产品"),           // 球栅阵列封装产品
    CSP("CSP", "芯片尺寸封装产品"),        // 芯片尺寸封装产品
    WLP("WLP", "晶圆级封装产品"),          // 晶圆级封装产品
    SiP("SiP", "系统级封装产品"),          // 系统级封装产品
    CUSTOM("CUSTOM", "自定义产品")         // 自定义产品类型
}
```

### 3.2 产品状态

```java
public enum ProductStatus {
    REGISTERED("已注册", 1, true),        // 产品已注册，激活状态
    IN_PRODUCTION("生产中", 2, true),      // 产品在生产中，激活状态
    QUALITY_CHECK("质量检验", 3, true),    // 产品质量检验中，激活状态
    PACKAGING("包装中", 4, true),         // 产品包装中，激活状态
    WAREHOUSING("入库中", 5, true),       // 产品入库中，激活状态
    IN_STORAGE("已入库", 6, true),        // 产品已入库，激活状态
    SHIPPING("发货中", 7, true),          // 产品发货中，激活状态
    DELIVERED("已交付", 8, true),         // 产品已交付，激活状态
    RETURNED("已退回", 9, true),          // 产品已退回，激活状态
    REWORK("返工中", 10, true),           // 产品返工中，激活状态
    SCRAPPED("已报废", 11, false),        // 产品已报废，非激活状态
    ARCHIVED("已归档", 12, false)         // 产品已归档，非激活状态
}
```

## 4. 基本使用方法

### 4.1 产品唯一标识生成

```java
// 生成指定类型的产品序列号
String serialNumber = ProductSerializer.generateProductSerialNumber(
    ProductSerializer.ProductType.WIRE_BONDING
);

if (serialNumber != null) {
    System.out.println("生成的产品序列号: " + serialNumber);
} else {
    System.err.println("序列号生成失败");
}

// 带参数的产品序列号生成
Map<String, Object> parameters = new HashMap<>();
parameters.put("line", "LINE_A");
parameters.put("shift", "DAY_SHIFT");
parameters.put("operator", "张三");

String customSerialNumber = ProductSerializer.generateProductSerialNumber(
    ProductSerializer.ProductType.BGA, 
    parameters
);

System.out.println("自定义参数生成的序列号: " + customSerialNumber);
```

### 4.2 产品信息管理

```java
// 创建产品信息
ProductSerializer.ProductInfo productInfo = ProductSerializer.createProductInfo(
    ProductSerializer.ProductType.FLIP_CHIP,  // 产品类型
    "FC-256-QFN"                             // 产品名称
);

if (productInfo != null) {
    System.out.println("产品创建成功:");
    System.out.println("  序列号: " + productInfo.getSerialNumber());
    System.out.println("  产品类型: " + productInfo.getProductType().getDescription());
    System.out.println("  产品名称: " + productInfo.getProductName());
    System.out.println("  当前状态: " + productInfo.getCurrentStatus().getDescription());
    System.out.println("  创建时间: " + productInfo.getRegistrationTime());
    System.out.println("  是否激活: " + productInfo.isActive());
} else {
    System.err.println("产品创建失败");
}

// 添加产品属性
if (productInfo != null) {
    productInfo.setAttribute("customer", "客户A")
              .setAttribute("orderNumber", "ORDER_20250821001")
              .setAttribute("priority", "HIGH")
              .setAttribute("specialRequirements", "无铅工艺");
    
    System.out.println("产品属性:");
    productInfo.getAttributes().forEach((key, value) -> 
        System.out.println("  " + key + ": " + value));
}

// 获取产品信息
ProductSerializer.ProductInfo retrievedInfo = ProductSerializer.getProductInfo(
    productInfo.getSerialNumber()
);

if (retrievedInfo != null) {
    System.out.println("获取到的产品信息:");
    System.out.println("  序列号: " + retrievedInfo.getSerialNumber());
    System.out.println("  产品名称: " + retrievedInfo.getProductName());
    System.out.println("  当前状态: " + retrievedInfo.getCurrentStatus().getDescription());
    
    // 显示状态历史
    System.out.println("  状态历史:");
    for (ProductSerializer.ProductStatusRecord record : retrievedInfo.getStatusHistory()) {
        System.out.println("    " + record.getTimestamp() + 
                          " - " + record.getStatus().getDescription() + 
                          " (" + record.getDescription() + ")");
    }
}
```

### 4.3 产品状态更新

```java
// 更新产品状态
boolean statusUpdated = ProductSerializer.updateProductStatus(
    productInfo.getSerialNumber(),              // 产品序列号
    ProductSerializer.ProductStatus.IN_PRODUCTION, // 新状态
    "开始生产流程",                              // 状态变更描述
    "生产管理员"                                // 操作员
);

if (statusUpdated) {
    System.out.println("产品状态更新成功");
    
    // 验证状态更新
    ProductSerializer.ProductInfo updatedInfo = ProductSerializer.getProductInfo(
        productInfo.getSerialNumber()
    );
    
    if (updatedInfo != null) {
        System.out.println("更新后的状态: " + updatedInfo.getCurrentStatus().getDescription());
    }
} else {
    System.err.println("产品状态更新失败");
}

// 批量状态更新示例
List<String> productSerials = Arrays.asList(
    "SN001", "SN002", "SN003", "SN004", "SN005"
);

for (String serial : productSerials) {
    ProductSerializer.updateProductStatus(
        serial,
        ProductSerializer.ProductStatus.QUALITY_CHECK,
        "转入质量检验",
        "质检员"
    );
    System.out.println("产品 " + serial + " 状态已更新为质量检验");
}
```

### 4.4 产品全程追溯

```java
// 生成产品全程追溯信息
ProductSerializer.ProductTrace trace = ProductSerializer.generateProductTrace(
    productInfo.getSerialNumber()
);

if (trace != null) {
    System.out.println("产品追溯信息:");
    System.out.println("  追溯ID: " + trace.getTraceId());
    System.out.println("  产品序列号: " + trace.getSerialNumber());
    System.out.println("  事件数量: " + trace.getTraceEvents().size());
    System.out.println("  开始时间: " + trace.getStartTime());
    System.out.println("  是否完整: " + trace.isComplete());
    
    // 显示追溯事件
    System.out.println("  追溯事件:");
    for (ProductSerializer.TraceEvent event : trace.getTraceEvents()) {
        System.out.println("    " + event.getTimestamp() + 
                          " - " + event.getOperationType() + 
                          " (" + event.getOperator() + ")");
    }
    
    // 显示摘要信息
    System.out.println("  摘要信息:");
    trace.getSummary().forEach((key, value) -> 
        System.out.println("    " + key + ": " + value));
} else {
    System.err.println("产品追溯信息生成失败");
}

// 添加自定义追溯事件
ProductSerializer.ProductionEvent productionEvent = new ProductSerializer.ProductionEvent(
    "焊接工艺",      // 工艺步骤
    "WELDER_001",   // 设备ID
    "操作员A"        // 操作员
)
.setParameter("temperature", 285.0)
.setParameter("time", 3.5)
.setParameter("pressure", 15.0);

boolean eventAdded = ProductSerializer.addTraceEvent(
    productInfo.getSerialNumber(),
    productionEvent
);

if (eventAdded) {
    System.out.println("生产事件添加成功");
} else {
    System.err.println("生产事件添加失败");
}

// 添加质量检验事件
ProductSerializer.QualityInspectionEvent inspectionEvent = new ProductSerializer.QualityInspectionEvent(
    "最终检验",      // 检验类型
    "质检员B",       // 检验员
    true,           // 是否通过
    "所有参数符合规范" // 检验结果
)
.addDefect("轻微划痕"); // 添加缺陷信息

eventAdded = ProductSerializer.addTraceEvent(
    productInfo.getSerialNumber(),
    inspectionEvent
);

if (eventAdded) {
    System.out.println("质量检验事件添加成功");
} else {
    System.err.println("质量检验事件添加失败");
}
```

## 5. 高级使用示例

### 5.1 完整的产品生命周期管理

```java
public class ProductLifecycleManager {
    public void manageCompleteProductLifecycle() {
        try {
            System.out.println("=== 开始完整产品生命周期管理 ===");
            
            // 1. 产品注册
            System.out.println("步骤1: 产品注册");
            ProductSerializer.ProductInfo product = registerNewProduct();
            
            if (product == null) {
                System.err.println("产品注册失败");
                return;
            }
            
            // 2. 生产流程
            System.out.println("\n步骤2: 生产流程");
            executeProductionProcess(product.getSerialNumber());
            
            // 3. 质量检验
            System.out.println("\n步骤3: 质量检验");
            performQualityInspection(product.getSerialNumber());
            
            // 4. 包装入库
            System.out.println("\n步骤4: 包装入库");
            packageAndStoreProduct(product.getSerialNumber());
            
            // 5. 生成追溯报告
            System.out.println("\n步骤5: 生成追溯报告");
            generateTraceReport(product.getSerialNumber());
            
            System.out.println("\n=== 产品生命周期管理完成 ===");
            
        } catch (Exception e) {
            System.err.println("产品生命周期管理过程中发生错误: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    private ProductSerializer.ProductInfo registerNewProduct() {
        // 创建产品信息
        ProductSerializer.ProductInfo product = ProductSerializer.createProductInfo(
            ProductSerializer.ProductType.WIRE_BONDING,
            "WB-128-TQFP"
        );
        
        if (product != null) {
            // 添加产品属性
            product.setAttribute("customer", "ABC电子")
                   .setAttribute("orderNumber", "ORD20250821001")
                   .setAttribute("deliveryDate", "2025-09-15")
                   .setAttribute("specialRequirements", "RoHS合规");
            
            System.out.println("产品注册成功: " + product.getSerialNumber());
        }
        
        return product;
    }
    
    private void executeProductionProcess(String serialNumber) {
        // 更新状态为生产中
        ProductSerializer.updateProductStatus(
            serialNumber,
            ProductSerializer.ProductStatus.IN_PRODUCTION,
            "开始生产流程",
            "生产计划员"
        );
        
        // 模拟生产步骤
        String[] processSteps = {"晶圆准备", "引线键合", "塑封", "切筋成型", "外观检查"};
        String[] equipments = {"PREP_001", "WB_001", "MOLD_001", "TRIM_001", "VISUAL_001"};
        
        Random random = new Random();
        for (int i = 0; i < processSteps.length; i++) {
            // 添加生产事件
            ProductSerializer.ProductionEvent event = new ProductSerializer.ProductionEvent(
                processSteps[i],
                equipments[i],
                "操作员_" + (i + 1)
            )
            .setParameter("duration", 30 + random.nextInt(30)) // 30-60分钟
            .setParameter("yield", 95.0 + random.nextDouble() * 5); // 95-100% 良率
            
            ProductSerializer.addTraceEvent(serialNumber, event);
            
            System.out.println("完成生产步骤: " + processSteps[i]);
        }
        
        // 更新状态为质量检验
        ProductSerializer.updateProductStatus(
            serialNumber,
            ProductSerializer.ProductStatus.QUALITY_CHECK,
            "生产完成，转入质量检验",
            "生产线主管"
        );
        
        System.out.println("生产流程完成");
    }
    
    private void performQualityInspection(String serialNumber) {
        // 模拟质量检验
        Random random = new Random();
        boolean passed = random.nextDouble() > 0.1; // 90% 通过率
        
        ProductSerializer.QualityInspectionEvent inspectionEvent = new ProductSerializer.QualityInspectionEvent(
            "最终检验",
            "质检员_甲",
            passed,
            passed ? "所有参数符合规范" : "部分参数超出公差范围"
        );
        
        if (!passed) {
            // 添加缺陷信息
            if (random.nextBoolean()) {
                inspectionEvent.addDefect("引脚共面度超差");
            }
            if (random.nextBoolean()) {
                inspectionEvent.addDefect("塑封体有微裂纹");
            }
        }
        
        ProductSerializer.addTraceEvent(serialNumber, inspectionEvent);
        
        // 更新状态
        ProductSerializer.ProductStatus newStatus = passed ? 
            ProductSerializer.ProductStatus.PACKAGING : 
            ProductSerializer.ProductStatus.REWORK;
            
        ProductSerializer.updateProductStatus(
            serialNumber,
            newStatus,
            passed ? "质量检验通过" : "需要返工",
            "质检主管"
        );
        
        System.out.println("质量检验" + (passed ? "通过" : "未通过"));
    }
    
    private void packageAndStoreProduct(String serialNumber) {
        // 更新状态为包装中
        ProductSerializer.updateProductStatus(
            serialNumber,
            ProductSerializer.ProductStatus.PACKAGING,
            "开始包装流程",
            "包装线主管"
        );
        
        // 模拟包装过程
        ProductSerializer.ProductionEvent packagingEvent = new ProductSerializer.ProductionEvent(
            "产品包装",
            "PACK_001",
            "包装操作员"
        )
        .setParameter("packageType", "管装")
        .setParameter("quantity", 1000)
        .setParameter("labelVerified", true);
        
        ProductSerializer.addTraceEvent(serialNumber, packagingEvent);
        
        // 更新状态为入库中
        ProductSerializer.updateProductStatus(
            serialNumber,
            ProductSerializer.ProductStatus.WAREHOUSING,
            "包装完成，准备入库",
            "仓库管理员"
        );
        
        // 模拟入库
        ProductSerializer.ProductionEvent warehousingEvent = new ProductSerializer.ProductionEvent(
            "产品入库",
            "WMS_001",
            "仓库管理员"
        )
        .setParameter("storageLocation", "A区-05架-12层")
        .setParameter("inventoryId", "INV_" + System.currentTimeMillis());
        
        ProductSerializer.addTraceEvent(serialNumber, warehousingEvent);
        
        // 更新状态为已入库
        ProductSerializer.updateProductStatus(
            serialNumber,
            ProductSerializer.ProductStatus.IN_STORAGE,
            "产品已入库",
            "仓库主管"
        );
        
        System.out.println("包装入库流程完成");
    }
    
    private void generateTraceReport(String serialNumber) {
        ProductSerializer.ProductTrace trace = ProductSerializer.generateProductTrace(serialNumber);
        
        if (trace != null) {
            System.out.println("产品追溯报告:");
            System.out.println("  产品序列号: " + trace.getSerialNumber());
            System.out.println("  追溯事件数: " + trace.getTraceEvents().size());
            System.out.println("  生命周期时长: " + trace.getSummary().get("duration"));
            
            // 显示操作类型分布
            Object operationDist = trace.getSummary().get("operationDistribution");
            if (operationDist instanceof Map) {
                System.out.println("  操作类型分布:");
                ((Map<?, ?>) operationDist).forEach((key, value) -> 
                    System.out.println("    " + key + ": " + value));
            }
        }
    }
}
```

### 5.2 产品信息查询和分析

```java
public class ProductInfoAnalyzer {
    public void analyzeProductInformation() {
        try {
            System.out.println("=== 产品信息分析 ===");
            
            // 创建查询条件
            ProductSerializer.ProductQuery query = new ProductSerializer.ProductQuery()
                .setProductType(ProductSerializer.ProductType.BGA)
                .setProductStatus(ProductSerializer.ProductStatus.IN_STORAGE)
                .setStartDate(LocalDateTime.now().minusDays(30))
                .setPageSize(20)
                .setSortBy("registrationTime")
                .setAscending(false);
            
            // 执行查询
            List<ProductSerializer.ProductInfo> products = 
                ProductSerializer.queryProductInfos(query);
            
            System.out.println("查询到 " + products.size() + " 个产品:");
            
            // 统计分析
            performStatisticalAnalysis(products);
            
            // 显示详细信息
            displayProductDetails(products);
            
        } catch (Exception e) {
            System.err.println("产品信息分析过程中发生错误: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    private void performStatisticalAnalysis(List<ProductSerializer.ProductInfo> products) {
        if (products.isEmpty()) {
            System.out.println("没有产品数据可供分析");
            return;
        }
        
        System.out.println("统计分析结果:");
        
        // 按状态统计
        Map<ProductSerializer.ProductStatus, Long> statusCount = products.stream()
            .collect(Collectors.groupingBy(
                ProductSerializer.ProductInfo::getCurrentStatus,
                Collectors.counting()
            ));
        
        System.out.println("  状态分布:");
        statusCount.forEach((status, count) -> 
            System.out.println("    " + status.getDescription() + ": " + count));
        
        // 按注册时间统计
        Map<String, Long> dailyCount = products.stream()
            .collect(Collectors.groupingBy(
                product -> product.getRegistrationTime().toLocalDate().toString(),
                Collectors.counting()
            ));
        
        System.out.println("  每日注册数量:");
        dailyCount.entrySet().stream()
            .sorted(Map.Entry.comparingByKey())
            .forEach(entry -> 
                System.out.println("    " + entry.getKey() + ": " + entry.getValue()));
    }
    
    private void displayProductDetails(List<ProductSerializer.ProductInfo> products) {
        System.out.println("产品详细信息:");
        
        products.stream()
            .limit(5) // 只显示前5个产品
            .forEach(product -> {
                System.out.println("  产品序列号: " + product.getSerialNumber());
                System.out.println("    类型: " + product.getProductType().getDescription());
                System.out.println("    名称: " + product.getProductName());
                System.out.println("    状态: " + product.getCurrentStatus().getDescription());
                System.out.println("    注册时间: " + product.getRegistrationTime());
                
                // 显示部分属性
                Map<String, Object> attributes = product.getAttributes();
                if (!attributes.isEmpty()) {
                    System.out.println("    属性:");
                    attributes.entrySet().stream()
                        .limit(3)
                        .forEach(entry -> 
                            System.out.println("      " + entry.getKey() + ": " + entry.getValue()));
                }
                
                System.out.println();
            });
    }
    
    public void analyzeProductTrace(String serialNumber) {
        try {
            System.out.println("=== 产品追溯分析: " + serialNumber + " ===");
            
            // 查询追溯事件
            ProductSerializer.TraceQuery traceQuery = new ProductSerializer.TraceQuery()
                .setLimit(50);
            
            List<ProductSerializer.TraceEvent> events = 
                ProductSerializer.queryTraceEvents(serialNumber, traceQuery);
            
            System.out.println("查询到 " + events.size() + " 个追溯事件:");
            
            // 按时间排序显示事件
            events.stream()
                .sorted(Comparator.comparing(ProductSerializer.TraceEvent::getTimestamp))
                .forEach(event -> {
                    System.out.println("  " + event.getTimestamp() + 
                                     " - " + event.getOperationType() + 
                                     " (" + event.getOperator() + ")");
                    
                    // 显示事件属性
                    if (!event.getAttributes().isEmpty()) {
                        event.getAttributes().forEach((key, value) -> 
                            System.out.println("    " + key + ": " + value));
                    }
                    System.out.println();
                });
                
        } catch (Exception e) {
            System.err.println("产品追溯分析过程中发生错误: " + e.getMessage());
            e.printStackTrace();
        }
    }
}
```

## 6. 配置参数详解

### 6.1 系统级配置参数

```java
public class ProductSerializerConfig {
    // 序列号长度
    public static final int SERIAL_NUMBER_LENGTH = 16;
    
    // 缓存超时时间（毫秒）
    public static final long CACHE_TIMEOUT = 30 * 60 * 1000; // 30分钟
    
    // 最大重试次数
    public static final int MAX_RETRY_ATTEMPTS = 3;
    
    // 重试延迟（毫秒）
    public static final long RETRY_DELAY = 1000; // 1秒
}
```

### 6.2 产品查询配置

```java
ProductSerializer.ProductQuery query = new ProductSerializer.ProductQuery()
    .setProductType(ProductSerializer.ProductType.WIRE_BONDING)  // 产品类型过滤
    .setProductStatus(ProductSerializer.ProductStatus.IN_PRODUCTION) // 状态过滤
    .setStartDate(LocalDateTime.now().minusDays(7))  // 开始时间
    .setEndDate(LocalDateTime.now())                 // 结束时间
    .setKeyword("WB-128")                           // 关键字搜索
    .setPage(1)                                     // 页码
    .setPageSize(50)                                // 每页数量
    .setSortBy("registrationTime")                  // 排序字段
    .setAscending(false);                           // 是否升序
```

### 6.3 追溯查询配置

```java
ProductSerializer.TraceQuery traceQuery = new ProductSerializer.TraceQuery()
    .setStartDate(LocalDateTime.now().minusDays(30)) // 开始时间
    .setEndDate(LocalDateTime.now())                 // 结束时间
    .setEventType("PRODUCTION")                      // 事件类型
    .setOperator("张三")                              // 操作员
    .setLimit(100);                                  // 限制数量
```

## 7. 错误处理

### 7.1 异常处理示例

```java
public class ProductSerializerErrorHandler {
    public void handleProductOperations() {
        try {
            // 执行产品操作
            String serialNumber = ProductSerializer.generateProductSerialNumber(
                ProductSerializer.ProductType.BGA
            );
            
            if (serialNumber == null) {
                System.err.println("序列号生成失败");
                return;
            }
            
            ProductSerializer.ProductInfo product = ProductSerializer.createProductInfo(
                ProductSerializer.ProductType.BGA,
                "BGA-256-FBGA"
            );
            
            if (product == null) {
                System.err.println("产品创建失败");
                return;
            }
            
            boolean updated = ProductSerializer.updateProductStatus(
                product.getSerialNumber(),
                ProductSerializer.ProductStatus.IN_PRODUCTION
            );
            
            if (!updated) {
                System.err.println("状态更新失败");
                return;
            }
            
            System.out.println("所有产品操作成功完成");
            
        } catch (Exception e) {
            System.err.println("产品操作过程中发生异常: " + e.getMessage());
            
            // 根据异常类型进行不同处理
            if (e instanceof IllegalArgumentException) {
                System.err.println("输入参数错误");
            } else if (e instanceof IllegalStateException) {
                System.err.println("状态错误");
            } else {
                System.err.println("未知错误，请联系技术支持");
            }
            
            // 记录详细错误信息
            e.printStackTrace();
        }
    }
    
    public boolean safeProductOperation(String serialNumber, ProductSerializer.ProductStatus newStatus) {
        try {
            return ProductSerializer.updateProductStatus(serialNumber, newStatus);
        } catch (Exception e) {
            System.err.println("安全产品操作失败: " + e.getMessage());
            return false;
        }
    }
}
```

## 8. 最佳实践

### 8.1 产品数据管理最佳实践

```java
public class ProductDataManager {
    public boolean validateAndCreateProduct(ProductSerializer.ProductType type, 
                                         String productName, 
                                         Map<String, Object> attributes) {
        // 1. 输入验证
        if (type == null) {
            System.err.println("产品类型不能为空");
            return false;
        }
        
        if (productName == null || productName.trim().isEmpty()) {
            System.err.println("产品名称不能为空");
            return false;
        }
        
        // 2. 属性验证
        if (attributes != null) {
            for (Map.Entry<String, Object> entry : attributes.entrySet()) {
                if (entry.getKey() == null || entry.getKey().trim().isEmpty()) {
                    System.err.println("属性键不能为空");
                    return false;
                }
            }
        }
        
        // 3. 创建产品
        ProductSerializer.ProductInfo product = ProductSerializer.createProductInfo(type, productName);
        
        if (product == null) {
            System.err.println("产品创建失败");
            return false;
        }
        
        // 4. 设置属性
        if (attributes != null) {
            attributes.forEach((key, value) -> {
                if (key != null && value != null) {
                    product.setAttribute(key, value);
                }
            });
        }
        
        System.out.println("产品创建成功: " + product.getSerialNumber());
        return true;
    }
    
    public List<ProductSerializer.ProductInfo> batchCreateProducts(
            List<ProductCreationRequest> requests) {
        List<ProductSerializer.ProductInfo> createdProducts = new ArrayList<>();
        
        for (ProductCreationRequest request : requests) {
            try {
                ProductSerializer.ProductInfo product = ProductSerializer.createProductInfo(
                    request.getType(),
                    request.getProductName()
                );
                
                if (product != null) {
                    // 设置属性
                    if (request.getAttributes() != null) {
                        request.getAttributes().forEach(product::setAttribute);
                    }
                    
                    createdProducts.add(product);
                    System.out.println("批量创建产品成功: " + product.getSerialNumber());
                } else {
                    System.err.println("批量创建产品失败: " + request.getProductName());
                }
            } catch (Exception e) {
                System.err.println("创建产品时发生错误: " + e.getMessage());
            }
        }
        
        return createdProducts;
    }
    
    // 产品创建请求类
    public static class ProductCreationRequest {
        private ProductSerializer.ProductType type;
        private String productName;
        private Map<String, Object> attributes;
        
        public ProductCreationRequest(ProductSerializer.ProductType type, String productName) {
            this.type = type;
            this.productName = productName;
            this.attributes = new HashMap<>();
        }
        
        // Getters and Setters
        public ProductSerializer.ProductType getType() { return type; }
        public void setType(ProductSerializer.ProductType type) { this.type = type; }
        
        public String getProductName() { return productName; }
        public void setProductName(String productName) { this.productName = productName; }
        
        public Map<String, Object> getAttributes() { return attributes; }
        public void setAttribute(String key, Object value) { this.attributes.put(key, value); }
    }
}
```

### 8.2 性能优化实践

```java
public class ProductSerializerPerformanceOptimizer {
    private final Map<String, ProductSerializer.ProductInfo> productCache = new ConcurrentHashMap<>();
    private final long cacheTimeout = 600000; // 10分钟
    
    public ProductSerializer.ProductInfo getCachedProductInfo(String serialNumber) {
        // 检查本地缓存
        CachedProduct cached = (CachedProduct) productCache.get(serialNumber);
        
        if (cached != null && !cached.isExpired()) {
            System.out.println("从本地缓存获取产品信息: " + serialNumber);
            return cached.getProductInfo();
        }
        
        // 从序列化器获取
        ProductSerializer.ProductInfo product = ProductSerializer.getProductInfo(serialNumber);
        
        // 更新本地缓存
        if (product != null) {
            productCache.put(serialNumber, new CachedProduct(product, System.currentTimeMillis() + cacheTimeout));
        }
        
        return product;
    }
    
    public void batchUpdateProductStatus(List<String> serialNumbers, 
                                       ProductSerializer.ProductStatus newStatus,
                                       String description, 
                                       String operator) {
        ExecutorService executor = Executors.newFixedThreadPool(10);
        List<Future<Boolean>> futures = new ArrayList<>();
        
        for (String serialNumber : serialNumbers) {
            Future<Boolean> future = executor.submit(() -> 
                ProductSerializer.updateProductStatus(serialNumber, newStatus, description, operator)
            );
            futures.add(future);
        }
        
        // 等待所有更新完成
        int successCount = 0;
        for (int i = 0; i < futures.size(); i++) {
            try {
                if (futures.get(i).get(30, TimeUnit.SECONDS)) {
                    successCount++;
                }
            } catch (Exception e) {
                System.err.println("更新产品 " + serialNumbers.get(i) + " 状态时发生错误: " + e.getMessage());
            }
        }
        
        executor.shutdown();
        System.out.println("批量状态更新完成: " + successCount + "/" + serialNumbers.size() + " 成功");
    }
    
    // 缓存产品信息类
    private static class CachedProduct {
        private final ProductSerializer.ProductInfo productInfo;
        private final long expireTime;
        
        public CachedProduct(ProductSerializer.ProductInfo productInfo, long expireTime) {
            this.productInfo = productInfo;
            this.expireTime = expireTime;
        }
        
        public ProductSerializer.ProductInfo getProductInfo() { return productInfo; }
        public boolean isExpired() { return System.currentTimeMillis() > expireTime; }
    }
}
```

## 9. 系统集成

### 9.1 与Web服务集成

```java
@RestController
@RequestMapping("/api/products")
public class ProductSerializerController {
    
    @PostMapping("/create")
    public ResponseEntity<?> createProduct(@RequestBody ProductCreationRequest request) {
        try {
            ProductSerializer.ProductInfo product = ProductSerializer.createProductInfo(
                ProductSerializer.ProductType.valueOf(request.getType()),
                request.getProductName()
            );
            
            if (product != null) {
                // 设置属性
                if (request.getAttributes() != null) {
                    request.getAttributes().forEach((key, value) -> {
                        if (key != null && value != null) {
                            product.setAttribute(key, value.toString());
                        }
                    });
                }
                
                return ResponseEntity.ok(convertToResponse(product));
            } else {
                return ResponseEntity.badRequest().body("产品创建失败");
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("服务器内部错误: " + e.getMessage());
        }
    }
    
    @GetMapping("/{serialNumber}")
    public ResponseEntity<?> getProduct(@PathVariable String serialNumber) {
        try {
            ProductSerializer.ProductInfo product = ProductSerializer.getProductInfo(serialNumber);
            
            if (product != null) {
                return ResponseEntity.ok(convertToResponse(product));
            } else {
                return ResponseEntity.notFound().build();
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("获取产品信息失败: " + e.getMessage());
        }
    }
    
    @PutMapping("/{serialNumber}/status")
    public ResponseEntity<?> updateProductStatus(@PathVariable String serialNumber,
                                               @RequestBody StatusUpdateRequest request) {
        try {
            boolean updated = ProductSerializer.updateProductStatus(
                serialNumber,
                ProductSerializer.ProductStatus.valueOf(request.getNewStatus()),
                request.getDescription(),
                request.getOperator()
            );
            
            if (updated) {
                return ResponseEntity.ok("状态更新成功");
            } else {
                return ResponseEntity.badRequest().body("状态更新失败");
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("状态更新失败: " + e.getMessage());
        }
    }
    
    @GetMapping("/{serialNumber}/trace")
    public ResponseEntity<?> getProductTrace(@PathVariable String serialNumber) {
        try {
            ProductSerializer.ProductTrace trace = ProductSerializer.generateProductTrace(serialNumber);
            
            if (trace != null) {
                return ResponseEntity.ok(convertToResponse(trace));
            } else {
                return ResponseEntity.notFound().build();
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("生成追溯信息失败: " + e.getMessage());
        }
    }
    
    // 请求和响应类
    public static class ProductCreationRequest {
        private String type;
        private String productName;
        private Map<String, Object> attributes;
        
        // Getters and Setters
        public String getType() { return type; }
        public void setType(String type) { this.type = type; }
        
        public String getProductName() { return productName; }
        public void setProductName(String productName) { this.productName = productName; }
        
        public Map<String, Object> getAttributes() { return attributes; }
        public void setAttributes(Map<String, Object> attributes) { this.attributes = attributes; }
    }
    
    public static class StatusUpdateRequest {
        private String newStatus;
        private String description;
        private String operator;
        
        // Getters and Setters
        public String getNewStatus() { return newStatus; }
        public void setNewStatus(String newStatus) { this.newStatus = newStatus; }
        
        public String getDescription() { return description; }
        public void setDescription(String description) { this.description = description; }
        
        public String getOperator() { return operator; }
        public void setOperator(String operator) { this.operator = operator; }
    }
    
    // 转换方法
    private Object convertToResponse(ProductSerializer.ProductInfo product) {
        // 实现产品信息到响应对象的转换
        return new Object();
    }
    
    private Object convertToResponse(ProductSerializer.ProductTrace trace) {
        // 实现追溯信息到响应对象的转换
        return new Object();
    }
}
```

### 9.2 与调度系统集成

```java
@Component
public class ScheduledProductTasks {
    
    // 每天凌晨1点执行产品状态清理
    @Scheduled(cron = "0 0 1 * * ?")
    public void cleanupProductStatus() {
        System.out.println("开始执行产品状态清理任务...");
        
        try {
            // 查询需要清理的产品（如长期未更新状态的产品）
            ProductSerializer.ProductQuery query = new ProductSerializer.ProductQuery()
                .setProductStatus(ProductSerializer.ProductStatus.REGISTERED)
                .setStartDate(LocalDateTime.now().minusMonths(6)); // 6个月前注册的
            
            List<ProductSerializer.ProductInfo> oldProducts = 
                ProductSerializer.queryProductInfos(query);
            
            int archivedCount = 0;
            for (ProductSerializer.ProductInfo product : oldProducts) {
                // 将长期未处理的产品归档
                if (ProductSerializer.archiveProductInfo(product.getSerialNumber())) {
                    archivedCount++;
                }
            }
            
            System.out.println("产品状态清理完成，归档了 " + archivedCount + " 个产品");
        } catch (Exception e) {
            System.err.println("产品状态清理任务失败: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    // 每小时检查产品状态异常
    @Scheduled(fixedRate = 3600000) // 1小时
    public void checkProductStatusAnomalies() {
        System.out.println("开始检查产品状态异常...");
        
        try {
            // 查询异常状态的产品（如长时间处于同一状态）
            LocalDateTime thresholdTime = LocalDateTime.now().minusDays(7);
            
            ProductSerializer.ProductQuery query = new ProductSerializer.ProductQuery()
                .setProductStatus(ProductSerializer.ProductStatus.IN_PRODUCTION)
                .setStartDate(LocalDateTime.now().minusDays(30))
                .setEndDate(thresholdTime); // 7天前还在生产中的产品
            
            List<ProductSerializer.ProductInfo> stuckProducts = 
                ProductSerializer.queryProductInfos(query);
            
            if (!stuckProducts.isEmpty()) {
                System.out.println("发现 " + stuckProducts.size() + " 个状态异常的产品:");
                for (ProductSerializer.ProductInfo product : stuckProducts) {
                    System.out.println("  - " + product.getSerialNumber() + 
                                     " (" + product.getProductName() + ")");
                    // 可以发送告警通知
                    sendAnomalyAlert(product);
                }
            }
        } catch (Exception e) {
            System.err.println("产品状态异常检查失败: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    // 每周生成产品统计报告
    @Scheduled(cron = "0 0 2 * * MON") // 每周一凌晨2点
    public void generateWeeklyProductReport() {
        System.out.println("开始生成周产品统计报告...");
        
        try {
            LocalDateTime weekAgo = LocalDateTime.now().minusWeeks(1);
            
            // 查询上周的产品数据
            ProductSerializer.ProductQuery query = new ProductSerializer.ProductQuery()
                .setStartDate(weekAgo);
            
            List<ProductSerializer.ProductInfo> weeklyProducts = 
                ProductSerializer.queryProductInfos(query);
            
            // 生成统计报告
            generateProductStatisticsReport(weeklyProducts, weekAgo, LocalDateTime.now());
            
            System.out.println("周产品统计报告生成完成");
        } catch (Exception e) {
            System.err.println("周产品统计报告生成失败: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    private void sendAnomalyAlert(ProductSerializer.ProductInfo product) {
        // 发送异常告警（邮件、短信等）
        System.out.println("发送产品状态异常告警: " + product.getSerialNumber());
    }
    
    private void generateProductStatisticsReport(List<ProductSerializer.ProductInfo> products,
                                               LocalDateTime startTime, 
                                               LocalDateTime endTime) {
        // 生成产品统计报告
        System.out.println("生成产品统计报告，时间范围: " + startTime + " 到 " + endTime);
        System.out.println("  产品总数: " + products.size());
        
        // 按类型统计
        Map<ProductSerializer.ProductType, Long> typeCount = products.stream()
            .collect(Collectors.groupingBy(
                ProductSerializer.ProductInfo::getProductType,
                Collectors.counting()
            ));
        
        System.out.println("  类型分布:");
        typeCount.forEach((type, count) -> 
            System.out.println("    " + type.getDescription() + ": " + count));
    }
}
```

这个使用说明文档涵盖了 [ProductSerializer](file://E:\dossier\others\im-common\src\main\java\com\qtech\im\semiconductor\product\ProductSerializer.java#L34-L950)
的主要功能和使用方法，可以帮助开发者快速上手并正确使用该产品序列化管理工具类。