# MaterialTracker 使用说明文档

## 1. 概述

[MaterialTracker](file://E:\dossier\others\im-common\src\main\java\com\qtech\im\semiconductor\material\MaterialTracker.java#L34-L1563) 是一个专业的半导体物料追踪工具类，专门用于半导体封测行业的物料管理，包括物料批次追踪、质量状态查询、有效期管理和库存预警等功能。该工具解决了物料流转跟踪困难、物料批次管理混乱、物料质量追溯不完整和物料库存管理不精确等问题。

## 2. 核心功能

### 2.1 物料批次追踪
- 支持物料从入库到使用的全流程追踪
- 记录物料的移动历史和状态变更
- 提供完整的物料追溯信息

### 2.2 物料质量状态查询
- 实时查询物料的质量状态
- 管理物料检验历史记录
- 支持质量状态变更追踪

### 2.3 物料有效期管理
- 自动监控物料有效期
- 提前提醒即将过期的物料
- 防止使用过期物料造成的质量问题

### 2.4 物料库存预警
- 实时监控库存水平
- 在库存不足时发出预警
- 防止因缺料导致的生产中断

## 3. 支持的物料类型和状态

### 3.1 物料类型
```java
public enum MaterialType {
    SILICON_WAFER("硅晶圆", "Silicon Wafer"),           // 硅晶圆
    GOLD_WIRE("金丝", "Gold Wire"),                   // 金丝
    PLASTIC_PACKAGE("塑封料", "Plastic Package"),     // 塑封料
    METAL_LEAD_FRAME("金属引脚框架", "Metal Lead Frame"), // 金属引脚框架
    CERAMIC_SUBSTRATE("陶瓷基板", "Ceramic Substrate"), // 陶瓷基板
    SOLDER_PASTE("焊膏", "Solder Paste"),             // 焊膏
    CLEANING_CHEMICAL("清洗化学品", "Cleaning Chemical"), // 清洗化学品
    ADHESIVE("胶水", "Adhesive"),                     // 胶水
    ENCAPSULANT("封装材料", "Encapsulant"),           // 封装材料
    CUSTOM("自定义物料", "Custom Material")           // 自定义物料
}
```


### 3.2 物料状态
```java
public enum MaterialStatus {
    AVAILABLE("可用", 1),     // 可用
    IN_USE("使用中", 2),      // 使用中
    RESERVED("已预留", 3),    // 已预留
    EXPIRED("已过期", 4),     // 已过期
    QUARANTINED("已隔离", 5), // 已隔离
    DISPOSED("已处置", 6),    // 已处置
    DEPLETED("已耗尽", 7)     // 已耗尽
}
```


### 3.3 质量状态
```java
public enum QualityStatus {
    PASS("合格", 1),              // 合格
    FAIL("不合格", 2),            // 不合格
    PENDING("待检", 3),           // 待检
    UNDER_REVIEW("评审中", 4),    // 评审中
    CONDITIONAL_RELEASE("有条件放行", 5) // 有条件放行
}
```


## 4. 基本使用方法

### 4.1 创建和管理物料

```java
// 创建新物料
MaterialTracker.Material material = MaterialTracker.createMaterial(
    "金丝A型", 
    MaterialTracker.MaterialType.GOLD_WIRE
);

if (material != null) {
    System.out.println("创建物料成功:");
    System.out.println("  物料ID: " + material.getMaterialId());
    System.out.println("  物料名称: " + material.getMaterialName());
    System.out.println("  物料类型: " + material.getMaterialType().getChineseName());
    System.out.println("  当前状态: " + material.getStatus().getDescription());
    System.out.println("  质量状态: " + material.getQualityStatus().getDescription());
    
    // 设置物料属性
    material.setSpecification("直径: 25μm, 纯度: 99.99%")
           .setSupplier("ABC金材有限公司")
           .setManufactureDate(LocalDateTime.now().minusMonths(2))
           .setExpirationDate(LocalDateTime.now().plusYears(2))
           .setLotNumber("LOT-20250821-001")
           .setUnit("米")
           .setAttribute("存储条件", "干燥，避光，温度15-25℃")
           .setAttribute("最小包装量", 1000);
    
    // 更新物料信息
    boolean updated = MaterialTracker.updateMaterial(material);
    if (updated) {
        System.out.println("物料信息更新成功");
    } else {
        System.err.println("物料信息更新失败");
    }
} else {
    System.err.println("物料创建失败");
}

// 创建物料批次
MaterialTracker.MaterialBatch batch = MaterialTracker.createMaterialBatch(
    material.getMaterialId(), 
    "BATCH-20250821-001"
);

if (batch != null) {
    System.out.println("创建物料批次成功:");
    System.out.println("  批次ID: " + batch.getBatchId());
    System.out.println("  物料ID: " + batch.getMaterialId());
    System.out.println("  批次号: " + batch.getBatchNumber());
    System.out.println("  创建日期: " + batch.getCreationDate());
    System.out.println("  过期日期: " + batch.getExpirationDate());
    System.out.println("  质量状态: " + batch.getQualityStatus().getDescription());
} else {
    System.err.println("物料批次创建失败");
}

// 获取物料信息
MaterialTracker.Material retrievedMaterial = MaterialTracker.getMaterial(material.getMaterialId());
if (retrievedMaterial != null) {
    System.out.println("获取物料信息成功:");
    System.out.println("  物料名称: " + retrievedMaterial.getMaterialName());
    System.out.println("  规格: " + retrievedMaterial.getSpecification());
    System.out.println("  供应商: " + retrievedMaterial.getSupplier());
    System.out.println("  生产日期: " + retrievedMaterial.getManufactureDate());
    System.out.println("  过期日期: " + retrievedMaterial.getExpirationDate());
    System.out.println("  批号: " + retrievedMaterial.getLotNumber());
    
    // 显示自定义属性
    System.out.println("  自定义属性:");
    retrievedMaterial.getAttributes().forEach((key, value) -> 
        System.out.println("    " + key + ": " + value));
} else {
    System.err.println("物料信息获取失败");
}
```


### 4.2 物料批次追踪

```java
// 添加物料移动记录
MaterialTracker.MaterialMovement movement1 = new MaterialTracker.MaterialMovement(
    material.getMaterialId(), 
    MaterialTracker.TraceEventType.RECEIPT, 
    5000.0
)
.setFromLocation("供应商")
.setToLocation("原材料仓库A区")
.setOperator("张三")
.setReferenceNumber("PO-20250821-001")
.setAttribute("运输条件", "常温运输")
.setAttribute("接收时间", LocalDateTime.now().toString());

boolean movementAdded = MaterialTracker.addTraceMovement(material.getMaterialId(), movement1);

if (movementAdded) {
    System.out.println("物料移动记录添加成功");
} else {
    System.err.println("物料移动记录添加失败");
}

// 添加检验记录
MaterialTracker.MaterialMovement movement2 = new MaterialTracker.MaterialMovement(
    material.getMaterialId(), 
    MaterialTracker.TraceEventType.INSPECTION, 
    5000.0
)
.setFromLocation("原材料仓库A区")
.setToLocation("质检区")
.setOperator("李四")
.setAttribute("检验标准", "GB/T 12345-2020")
.setAttribute("检验设备", "金相显微镜XYZ-100");

movementAdded = MaterialTracker.addTraceMovement(material.getMaterialId(), movement2);

if (movementAdded) {
    System.out.println("检验记录添加成功");
    
    // 更新物料质量状态为合格
    material.setQualityStatus(MaterialTracker.QualityStatus.PASS);
    MaterialTracker.updateMaterial(material);
    System.out.println("物料质量状态更新为合格");
} else {
    System.err.println("检验记录添加失败");
}

// 添加发料记录
MaterialTracker.MaterialMovement movement3 = new MaterialTracker.MaterialMovement(
    material.getMaterialId(), 
    MaterialTracker.TraceEventType.ISSUE, 
    1000.0
)
.setFromLocation("质检区")
.setToLocation("生产线1号")
.setOperator("王五")
.setReferenceNumber("WO-20250821-001")
.setAttribute("用途", "引线键合工艺")
.setAttribute("发料时间", LocalDateTime.now().toString());

movementAdded = MaterialTracker.addTraceMovement(material.getMaterialId(), movement3);

if (movementAdded) {
    System.out.println("发料记录添加成功");
} else {
    System.err.println("发料记录添加失败");
}

// 查询物料追踪记录
MaterialTracker.TraceQuery query = new MaterialTracker.TraceQuery()
    .setStartDate(LocalDateTime.now().minusDays(7))
    .setLimit(50);

List<MaterialTracker.MaterialMovement> movements = MaterialTracker.queryTraceMovements(
    material.getMaterialId(), query);

System.out.println("查询到 " + movements.size() + " 条物料移动记录:");
for (MaterialTracker.MaterialMovement movement : movements) {
    System.out.println("  时间: " + movement.getMovementTime());
    System.out.println("    类型: " + movement.getEventType().getChineseName());
    System.out.println("    数量: " + movement.getQuantity() + " " + movement.getUnit());
    System.out.println("    从: " + movement.getFromLocation() + " 到: " + movement.getToLocation());
    System.out.println("    操作员: " + movement.getOperator());
    System.out.println("    参考号: " + movement.getReferenceNumber());
    
    if (!movement.getAttributes().isEmpty()) {
        System.out.println("    属性:");
        movement.getAttributes().forEach((key, value) -> 
            System.out.println("      " + key + ": " + value));
    }
    System.out.println();
}

// 生成物料追踪报告
MaterialTracker.MaterialTrace trace = MaterialTracker.traceMaterial(material.getMaterialId());

if (trace != null) {
    System.out.println("物料追踪报告:");
    System.out.println("  追溯ID: " + trace.getTraceId());
    System.out.println("  物料ID: " + trace.getMaterialId());
    System.out.println("  移动记录数: " + trace.getMovements().size());
    System.out.println("  开始时间: " + trace.getStartTime());
    
    // 显示摘要信息
    System.out.println("  摘要:");
    trace.getSummary().forEach((key, value) -> 
        System.out.println("    " + key + ": " + value));
    
    // 显示移动记录详情
    System.out.println("  移动记录详情:");
    for (MaterialTracker.MaterialMovement movement : trace.getMovements()) {
        System.out.println("    - " + movement.getEventType().getChineseName() + 
                          " " + movement.getQuantity() + movement.getUnit() + 
                          " at " + movement.getMovementTime());
    }
} else {
    System.err.println("物料追踪报告生成失败");
}
```


### 4.3 物料质量状态管理

```java
// 查询物料当前质量状态
MaterialTracker.QualityStatus currentStatus = MaterialTracker.getMaterialQualityStatus(
    material.getMaterialId());

System.out.println("物料当前质量状态: " + currentStatus.getDescription());

// 创建质量检验记录
MaterialTracker.QualityRecord qualityRecord = new MaterialTracker.QualityRecord(
    material.getMaterialId(), 
    MaterialTracker.QualityStatus.PASS
)
.setInspector("质检员李四")
.setInspectionReport("检验报告编号: IR-20250821-001")
.setRemarks("符合技术规范要求")
.setTestResult("直径", 25.2)
.setTestResult("纯度", 99.995)
.setTestResult("抗拉强度", 450);

System.out.println("创建质量检验记录:");
System.out.println("  记录ID: " + qualityRecord.getRecordId());
System.out.println("  检验员: " + qualityRecord.getInspector());
System.out.println("  检验时间: " + qualityRecord.getInspectionTime());
System.out.println("  质量状态: " + qualityRecord.getStatus().getDescription());
System.out.println("  检验报告: " + qualityRecord.getInspectionReport());
System.out.println("  备注: " + qualityRecord.getRemarks());

// 显示测试结果
System.out.println("  测试结果:");
qualityRecord.getTestResults().forEach((key, value) -> 
    System.out.println("    " + key + ": " + value));

// 更新物料质量状态
material.setQualityStatus(qualityRecord.getStatus());
boolean updated = MaterialTracker.updateMaterial(material);

if (updated) {
    System.out.println("物料质量状态更新成功: " + qualityRecord.getStatus().getDescription());
} else {
    System.err.println("物料质量状态更新失败");
}

// 查询物料质量历史
MaterialTracker.QualityStatusHistory qualityHistory = MaterialTracker.getMaterialQualityHistory(
    material.getMaterialId());

if (qualityHistory != null) {
    System.out.println("物料质量历史记录:");
    System.out.println("  历史ID: " + qualityHistory.getHistoryId());
    System.out.println("  物料ID: " + qualityHistory.getMaterialId());
    System.out.println("  记录数量: " + qualityHistory.getRecords().size());
    System.out.println("  最后更新: " + qualityHistory.getLastUpdate());
    
    System.out.println("  详细记录:");
    for (MaterialTracker.QualityRecord record : qualityHistory.getRecords()) {
        System.out.println("    - 时间: " + record.getInspectionTime());
        System.out.println("      检验员: " + record.getInspector());
        System.out.println("      状态: " + record.getStatus().getDescription());
        System.out.println("      报告: " + record.getInspectionReport());
        if (!record.getRemarks().isEmpty()) {
            System.out.println("      备注: " + record.getRemarks());
        }
    }
} else {
    System.err.println("物料质量历史查询失败");
}
```


### 4.4 物料有效期管理

```java
// 检查物料是否即将过期
MaterialTracker.ExpirationAlert expirationAlert = MaterialTracker.checkMaterialExpiration(
    material.getMaterialId());

if (expirationAlert != null) {
    System.out.println("物料过期预警:");
    System.out.println("  预警ID: " + expirationAlert.getAlertId());
    System.out.println("  物料ID: " + expirationAlert.getMaterialId());
    System.out.println("  预警类型: " + expirationAlert.getAlertType().getChineseName());
    System.out.println("  过期日期: " + expirationAlert.getExpirationDate());
    System.out.println("  距离过期天数: " + expirationAlert.getDaysUntilExpiration());
    System.out.println("  预警消息: " + expirationAlert.getMessage());
    System.out.println("  预警时间: " + expirationAlert.getAlertTime());
} else {
    System.out.println("物料无过期风险");
}

// 设置物料即将过期进行测试
material.setExpirationDate(LocalDateTime.now().plusDays(5));
MaterialTracker.updateMaterial(material);

// 再次检查过期情况
expirationAlert = MaterialTracker.checkMaterialExpiration(material.getMaterialId());

if (expirationAlert != null) {
    System.out.println("物料即将过期预警:");
    System.out.println("  预警消息: " + expirationAlert.getMessage());
    System.out.println("  建议操作: 及时使用或申请延期");
} else {
    System.out.println("物料无过期风险");
}

// 检查批次过期情况
List<MaterialTracker.ExpirationAlert> batchAlerts = MaterialTracker.checkBatchExpirations(
    batch.getBatchId());

if (!batchAlerts.isEmpty()) {
    System.out.println("批次过期预警:");
    for (MaterialTracker.ExpirationAlert alert : batchAlerts) {
        System.out.println("  - " + alert.getMessage());
    }
} else {
    System.out.println("批次无过期风险");
}
```


### 4.5 物料库存预警

```java
// 模拟物料库存减少
material.setAttribute("current_quantity", 800.0); // 当前库存800米
MaterialTracker.updateMaterial(material);

// 检查库存水平
MaterialTracker.InventoryAlert inventoryAlert = MaterialTracker.checkInventoryLevel(
    material.getMaterialId());

if (inventoryAlert != null) {
    System.out.println("库存预警:");
    System.out.println("  预警ID: " + inventoryAlert.getAlertId());
    System.out.println("  物料ID: " + inventoryAlert.getMaterialId());
    System.out.println("  预警类型: " + inventoryAlert.getAlertType().getChineseName());
    System.out.println("  当前库存: " + inventoryAlert.getCurrentQuantity() + " " + inventoryAlert.getUnit());
    System.out.println("  最低库存: " + inventoryAlert.getMinimumQuantity() + " " + inventoryAlert.getUnit());
    System.out.println("  阈值百分比: " + inventoryAlert.getThresholdPercentage() + "%");
    System.out.println("  预警消息: " + inventoryAlert.getMessage());
    System.out.println("  预警时间: " + inventoryAlert.getAlertTime());
    System.out.println("  建议操作: 及时补货");
} else {
    System.out.println("库存水平正常");
}

// 批量检查多个物料库存
List<String> materialIds = Arrays.asList(material.getMaterialId(), "MATERIAL_002", "MATERIAL_003");
Map<String, MaterialTracker.InventoryAlert> alerts = MaterialTracker.checkMultipleInventories(
    materialIds);

System.out.println("批量库存检查结果:");
if (alerts.isEmpty()) {
    System.out.println("所有物料库存水平正常");
} else {
    System.out.println("发现 " + alerts.size() + " 个库存预警:");
    alerts.forEach((matId, alert) -> 
        System.out.println("  物料 " + matId + ": " + alert.getMessage()));
}
```


## 5. 高级使用示例

### 5.1 完整的物料管理流程

```java
public class CompleteMaterialManagement {
    public void manageCompleteMaterialLifecycle() {
        try {
            System.out.println("=== 开始完整物料管理流程 ===");
            
            // 1. 创建物料和批次
            System.out.println("步骤1: 创建物料和批次");
            MaterialTracker.Material material = createMaterial();
            
            if (material == null) {
                System.err.println("物料创建失败");
                return;
            }
            
            MaterialTracker.MaterialBatch batch = createBatch(material);
            
            // 2. 物料入库和检验
            System.out.println("\n步骤2: 物料入库和检验");
            receiveAndInspectMaterial(material, batch);
            
            // 3. 物料使用追踪
            System.out.println("\n步骤3: 物料使用追踪");
            trackMaterialUsage(material);
            
            // 4. 质量状态管理
            System.out.println("\n步骤4: 质量状态管理");
            manageQualityStatus(material);
            
            // 5. 有效期和库存监控
            System.out.println("\n步骤5: 有效期和库存监控");
            monitorExpirationAndInventory(material, batch);
            
            // 6. 生成物料追踪报告
            System.out.println("\n步骤6: 生成物料追踪报告");
            generateMaterialTraceReport(material);
            
            System.out.println("\n=== 物料管理流程完成 ===");
            
        } catch (Exception e) {
            System.err.println("物料管理流程中发生错误: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    private MaterialTracker.Material createMaterial() {
        // 创建金丝物料
        MaterialTracker.Material material = MaterialTracker.createMaterial(
            "超细金丝B型", 
            MaterialTracker.MaterialType.GOLD_WIRE
        );
        
        if (material != null) {
            // 设置物料详细信息
            material.setSpecification("直径: 20μm, 纯度: 99.999%")
                   .setSupplier("XYZ贵金属有限公司")
                   .setManufactureDate(LocalDateTime.now().minusMonths(1))
                   .setExpirationDate(LocalDateTime.now().plusYears(3))
                   .setLotNumber("LOT-20250821-B001")
                   .setUnit("米")
                   .setAttribute("存储条件", "干燥，避光，温度15-25℃，湿度<60%")
                   .setAttribute("最小包装量", 2000)
                   .setAttribute("current_quantity", 10000.0); // 初始库存10000米
            
            boolean updated = MaterialTracker.updateMaterial(material);
            if (updated) {
                System.out.println("物料创建成功: " + material.getMaterialId());
                System.out.println("  名称: " + material.getMaterialName());
                System.out.println("  类型: " + material.getMaterialType().getChineseName());
                System.out.println("  规格: " + material.getSpecification());
                System.out.println("  供应商: " + material.getSupplier());
                System.out.println("  批号: " + material.getLotNumber());
                System.out.println("  库存: " + material.getAttribute("current_quantity") + "米");
            } else {
                System.err.println("物料信息更新失败");
                return null;
            }
        } else {
            System.err.println("物料创建失败");
            return null;
        }
        
        return material;
    }
    
    private MaterialTracker.MaterialBatch createBatch(MaterialTracker.Material material) {
        // 创建物料批次
        MaterialTracker.MaterialBatch batch = MaterialTracker.createMaterialBatch(
            material.getMaterialId(), 
            "BATCH-20250821-B001"
        );
        
        if (batch != null) {
            System.out.println("批次创建成功: " + batch.getBatchId());
            System.out.println("  批次号: " + batch.getBatchNumber());
            System.out.println("  创建日期: " + batch.getCreationDate());
            System.out.println("  过期日期: " + batch.getExpirationDate());
        } else {
            System.err.println("批次创建失败");
        }
        
        return batch;
    }
    
    private void receiveAndInspectMaterial(MaterialTracker.Material material, 
                                       MaterialTracker.MaterialBatch batch) {
        // 添加收货记录
        MaterialTracker.MaterialMovement receiptMovement = new MaterialTracker.MaterialMovement(
            material.getMaterialId(), 
            MaterialTracker.TraceEventType.RECEIPT, 
            10000.0
        )
        .setFromLocation("供应商XYZ贵金属有限公司")
        .setToLocation("原材料仓库A区-金丝存储区")
        .setOperator("仓库管理员张三")
        .setReferenceNumber("PO-20250821-B001")
        .setAttribute("运输条件", "常温运输，防震动")
        .setAttribute("接收时间", LocalDateTime.now().toString())
        .setAttribute("接收温度", "22℃")
        .setAttribute("接收湿度", "55%");
        
        boolean added = MaterialTracker.addTraceMovement(material.getMaterialId(), receiptMovement);
        if (added) {
            System.out.println("收货记录添加成功");
        } else {
            System.err.println("收货记录添加失败");
        }
        
        // 添加检验记录
        MaterialTracker.MaterialMovement inspectionMovement = new MaterialTracker.MaterialMovement(
            material.getMaterialId(), 
            MaterialTracker.TraceEventType.INSPECTION, 
            10000.0
        )
        .setFromLocation("原材料仓库A区-金丝存储区")
        .setToLocation("质检区-金丝检验台")
        .setOperator("质检员李四")
        .setAttribute("检验标准", "企业标准Q/XYZ 123-2025")
        .setAttribute("检验设备", "金相显微镜XYZ-200")
        .setAttribute("检验开始时间", LocalDateTime.now().toString());
        
        added = MaterialTracker.addTraceMovement(material.getMaterialId(), inspectionMovement);
        if (added) {
            System.out.println("检验记录添加成功");
        } else {
            System.err.println("检验记录添加失败");
        }
        
        // 创建质量检验记录
        MaterialTracker.QualityRecord qualityRecord = new MaterialTracker.QualityRecord(
            material.getMaterialId(), 
            MaterialTracker.QualityStatus.PASS
        )
        .setInspector("质检员李四")
        .setInspectionReport("检验报告编号: IR-20250821-B001")
        .setRemarks("符合技术规范要求，可投入使用")
        .setTestResult("直径", 20.1) // μm
        .setTestResult("纯度", 99.9995) // %
        .setTestResult("抗拉强度", 480) // MPa
        .setTestResult("延伸率", 8.5) // %
        .setTestResult("表面粗糙度", 0.05); // μm
        
        System.out.println("质量检验完成:");
        System.out.println("  检验结果: " + qualityRecord.getStatus().getDescription());
        System.out.println("  检验报告: " + qualityRecord.getInspectionReport());
        
        // 更新物料质量状态
        material.setQualityStatus(qualityRecord.getStatus());
        MaterialTracker.updateMaterial(material);
        System.out.println("物料质量状态更新为: " + qualityRecord.getStatus().getDescription());
        
        // 添加检验完成记录
        MaterialTracker.MaterialMovement inspectionCompleteMovement = new MaterialTracker.MaterialMovement(
            material.getMaterialId(), 
            MaterialTracker.TraceEventType.INSPECTION, 
            10000.0
        )
        .setFromLocation("质检区-金丝检验台")
        .setToLocation("合格品区-金丝存储区")
        .setOperator("质检员李四")
        .setAttribute("检验完成时间", LocalDateTime.now().toString())
        .setAttribute("检验结果", "合格");
        
        added = MaterialTracker.addTraceMovement(material.getMaterialId(), inspectionCompleteMovement);
        if (added) {
            System.out.println("检验完成记录添加成功");
        } else {
            System.err.println("检验完成记录添加失败");
        }
    }
    
    private void trackMaterialUsage(MaterialTracker.Material material) {
        // 模拟多次发料使用物料
        double[] usageAmounts = {1500.0, 2000.0, 1200.0};
        String[] workOrders = {"WO-20250821-001", "WO-20250821-002", "WO-20250821-003"};
        String[] operators = {"操作员王五", "操作员赵六", "操作员孙七"};
        
        double currentQuantity = (Double) material.getAttribute("current_quantity");
        
        for (int i = 0; i < usageAmounts.length; i++) {
            double usage = usageAmounts[i];
            currentQuantity -= usage;
            
            MaterialTracker.MaterialMovement usageMovement = new MaterialTracker.MaterialMovement(
                material.getMaterialId(), 
                MaterialTracker.TraceEventType.ISSUE, 
                usage
            )
            .setFromLocation("合格品区-金丝存储区")
            .setToLocation("生产线" + (i + 1) + "号")
            .setOperator(operators[i])
            .setReferenceNumber(workOrders[i])
            .setAttribute("用途", "引线键合工艺")
            .setAttribute("使用时间", LocalDateTime.now().toString())
            .setAttribute("剩余库存", currentQuantity);
            
            boolean added = MaterialTracker.addTraceMovement(material.getMaterialId(), usageMovement);
            if (added) {
                System.out.println("第" + (i + 1) + "次发料记录添加成功: " + usage + "米");
            } else {
                System.err.println("第" + (i + 1) + "次发料记录添加失败");
            }
            
            // 更新物料库存
            material.setAttribute("current_quantity", currentQuantity);
            MaterialTracker.updateMaterial(material);
        }
        
        System.out.println("物料使用追踪完成，当前剩余库存: " + currentQuantity + "米");
    }
    
    private void manageQualityStatus(MaterialTracker.Material material) {
        // 模拟定期质量复查
        MaterialTracker.QualityRecord reviewRecord = new MaterialTracker.QualityRecord(
            material.getMaterialId(), 
            MaterialTracker.QualityStatus.PASS
        )
        .setInspector("质检员李四")
        .setInspectionReport("复查报告编号: IR-20250825-R001")
        .setRemarks("库存物料定期复查，状态良好")
        .setTestResult("外观检查", "无氧化，无损伤")
        .setTestResult("存储环境", "符合要求");
        
        System.out.println("定期质量复查完成:");
        System.out.println("  复查结果: " + reviewRecord.getStatus().getDescription());
        System.out.println("  复查报告: " + reviewRecord.getInspectionReport());
        
        // 更新物料质量状态
        material.setQualityStatus(reviewRecord.getStatus());
        MaterialTracker.updateMaterial(material);
        System.out.println("物料质量状态更新为: " + reviewRecord.getStatus().getDescription());
    }
    
    private void monitorExpirationAndInventory(MaterialTracker.Material material, 
                                           MaterialTracker.MaterialBatch batch) {
        // 检查物料有效期
        MaterialTracker.ExpirationAlert expirationAlert = MaterialTracker.checkMaterialExpiration(
            material.getMaterialId());
        
        if (expirationAlert != null) {
            System.out.println("物料有效期检查:");
            System.out.println("  " + expirationAlert.getMessage());
        } else {
            System.out.println("物料有效期检查: 无过期风险");
        }
        
        // 检查批次有效期
        List<MaterialTracker.ExpirationAlert> batchAlerts = MaterialTracker.checkBatchExpirations(
            batch.getBatchId());
        
        if (!batchAlerts.isEmpty()) {
            System.out.println("批次有效期检查:");
            for (MaterialTracker.ExpirationAlert alert : batchAlerts) {
                System.out.println("  " + alert.getMessage());
            }
        } else {
            System.out.println("批次有效期检查: 无过期风险");
        }
        
        // 检查库存水平
        MaterialTracker.InventoryAlert inventoryAlert = MaterialTracker.checkInventoryLevel(
            material.getMaterialId());
        
        if (inventoryAlert != null) {
            System.out.println("库存水平检查:");
            System.out.println("  " + inventoryAlert.getMessage());
        } else {
            double currentQuantity = (Double) material.getAttribute("current_quantity");
            System.out.println("库存水平检查: 库存充足，当前库存 " + currentQuantity + "米");
        }
    }
    
    private void generateMaterialTraceReport(MaterialTracker.Material material) {
        // 生成物料追踪报告
        MaterialTracker.MaterialTrace trace = MaterialTracker.traceMaterial(material.getMaterialId());
        
        if (trace != null) {
            System.out.println("物料追踪报告生成成功:");
            System.out.println("  追溯ID: " + trace.getTraceId());
            System.out.println("  物料ID: " + trace.getMaterialId());
            System.out.println("  移动记录数: " + trace.getMovements().size());
            System.out.println("  追溯开始时间: " + trace.getStartTime());
            
            // 显示摘要信息
            System.out.println("  摘要信息:");
            trace.getSummary().forEach((key, value) -> 
                System.out.println("    " + key + ": " + value));
            
            // 显示移动记录统计
            Map<String, Long> eventTypeCount = trace.getMovements().stream()
                .collect(Collectors.groupingBy(
                    movement -> movement.getEventType().getChineseName(),
                    Collectors.counting()
                ));
            
            System.out.println("  移动类型统计:");
            eventTypeCount.forEach((type, count) -> 
                System.out.println("    " + type + ": " + count + "次"));
            
            // 显示最近几次移动记录
            System.out.println("  最近移动记录:");
            List<MaterialTracker.MaterialMovement> recentMovements = trace.getMovements().stream()
                .sorted((m1, m2) -> m2.getMovementTime().compareTo(m1.getMovementTime()))
                .limit(5)
                .collect(Collectors.toList());
            
            for (MaterialTracker.MaterialMovement movement : recentMovements) {
                System.out.println("    - " + movement.getMovementTime().toString().substring(0, 19) + 
                                  " " + movement.getEventType().getChineseName() + 
                                  " " + movement.getQuantity() + movement.getUnit() + 
                                  " [" + movement.getOperator() + "]");
            }
        } else {
            System.err.println("物料追踪报告生成失败");
        }
    }
}
```


### 5.2 物料监控和分析

```java
public class MaterialMonitoringAndAnalysis {
    public void monitorAndAnalyzeMaterials() {
        try {
            System.out.println("=== 物料监控和分析 ===");
            
            // 模拟监控多个物料
            List<String> materialIds = Arrays.asList(
                "MATERIAL_001", "MATERIAL_002", "MATERIAL_003", "MATERIAL_004", "MATERIAL_005"
            );
            
            // 分析物料状态
            analyzeMaterialStatuses(materialIds);
            
            // 检查过期预警
            checkExpirationAlerts(materialIds);
            
            // 检查库存预警
            checkInventoryAlerts(materialIds);
            
            // 生成统计报告
            generateStatisticalReport(materialIds);
            
        } catch (Exception e) {
            System.err.println("物料监控和分析过程中发生错误: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    private void analyzeMaterialStatuses(List<String> materialIds) {
        System.out.println("\n物料状态分析:");
        
        Map<MaterialTracker.MaterialStatus, Integer> statusCount = new HashMap<>();
        Map<MaterialTracker.QualityStatus, Integer> qualityCount = new HashMap<>();
        
        for (String materialId : materialIds) {
            MaterialTracker.Material material = MaterialTracker.getMaterial(materialId);
            if (material != null) {
                // 统计物料状态
                statusCount.merge(material.getStatus(), 1, Integer::sum);
                
                // 统计质量状态
                qualityCount.merge(material.getQualityStatus(), 1, Integer::sum);
            }
        }
        
        System.out.println("物料状态分布:");
        statusCount.forEach((status, count) -> 
            System.out.println("  " + status.getDescription() + ": " + count + "个"));
        
        System.out.println("质量状态分布:");
        qualityCount.forEach((quality, count) -> 
            System.out.println("  " + quality.getDescription() + ": " + count + "个"));
    }
    
    private void checkExpirationAlerts(List<String> materialIds) {
        System.out.println("\n过期预警检查:");
        
        int alertCount = 0;
        for (String materialId : materialIds) {
            MaterialTracker.ExpirationAlert alert = MaterialTracker.checkMaterialExpiration(materialId);
            if (alert != null) {
                System.out.println("  物料 " + materialId + ": " + alert.getMessage());
                alertCount++;
            }
        }
        
        if (alertCount == 0) {
            System.out.println("  无过期预警");
        } else {
            System.out.println("  共发现 " + alertCount + " 个过期预警");
        }
    }
    
    private void checkInventoryAlerts(List<String> materialIds) {
        System.out.println("\n库存预警检查:");
        
        Map<String, MaterialTracker.InventoryAlert> alerts = MaterialTracker.checkMultipleInventories(
            materialIds);
        
        if (alerts.isEmpty()) {
            System.out.println("  无库存预警");
        } else {
            System.out.println("  发现 " + alerts.size() + " 个库存预警:");
            alerts.forEach((materialId, alert) -> 
                System.out.println("    物料 " + materialId + ": " + alert.getMessage()));
        }
    }
    
    private void generateStatisticalReport(List<String> materialIds) {
        System.out.println("\n统计分析报告:");
        
        // 获取缓存统计信息
        MaterialTracker.CacheStatistics cacheStats = MaterialTracker.getCacheStatistics();
        
        System.out.println("系统缓存统计:");
        System.out.println("  物料缓存数量: " + cacheStats.getMaterialCacheSize());
        System.out.println("  批次缓存数量: " + cacheStats.getBatchCacheSize());
        System.out.println("  追溯缓存数量: " + cacheStats.getTraceCacheSize());
        System.out.println("  缓存超时时间: " + cacheStats.getCacheTimeout() + "ms");
        
        // 模拟物料使用效率分析
        System.out.println("\n物料使用效率分析:");
        System.out.println("  物料周转率: 85%");
        System.out.println("  平均库存周期: 45天");
        System.out.println("  过期物料比例: 2%");
        System.out.println("  质量合格率: 98.5%");
    }
    
    public void queryMaterialMovements(String materialId) {
        try {
            System.out.println("=== 查询物料移动记录: " + materialId + " ===");
            
            // 创建查询条件
            MaterialTracker.TraceQuery query = new MaterialTracker.TraceQuery()
                .setStartDate(LocalDateTime.now().minusDays(30)) // 最近30天
                .setLimit(100);
            
            List<MaterialTracker.MaterialMovement> movements = MaterialTracker.queryTraceMovements(
                materialId, query);
            
            System.out.println("查询到 " + movements.size() + " 条移动记录:");
            
            // 按时间排序显示
            movements.stream()
                .sorted(Comparator.comparing(MaterialTracker.MaterialMovement::getMovementTime))
                .forEach(movement -> {
                    System.out.println("  时间: " + movement.getMovementTime());
                    System.out.println("    类型: " + movement.getEventType().getChineseName());
                    System.out.println("    数量: " + movement.getQuantity() + " " + movement.getUnit());
                    System.out.println("    从: " + movement.getFromLocation() + " 到: " + movement.getToLocation());
                    System.out.println("    操作员: " + movement.getOperator());
                    
                    if (!movement.getAttributes().isEmpty()) {
                        System.out.println("    属性:");
                        movement.getAttributes().forEach((key, value) -> 
                            System.out.println("      " + key + ": " + value));
                    }
                    
                    System.out.println();
                });
                
        } catch (Exception e) {
            System.err.println("查询物料移动记录过程中发生错误: " + e.getMessage());
            e.printStackTrace();
        }
    }
}
```


## 6. 配置参数详解

### 6.1 系统级配置参数

```java
public class MaterialTrackerConfig {
    // 缓存超时时间（毫秒）
    public static final long CACHE_TIMEOUT = 30 * 60 * 1000; // 30分钟
    
    // 最大重试次数
    public static final int MAX_RETRY_ATTEMPTS = 3;
    
    // 重试延迟（毫秒）
    public static final long RETRY_DELAY = 1000; // 1秒
    
    // 追溯缓冲区大小
    public static final int TRACE_BUFFER_SIZE = 1000;
    
    // 库存预警阈值百分比
    public static final int INVENTORY_THRESHOLD_PERCENTAGE = 20; // 20%
    
    // 过期预警提前天数
    public static final long EXPIRATION_WARNING_DAYS = 7; // 7天
}
```


### 6.2 追溯查询配置

```java
MaterialTracker.TraceQuery query = new MaterialTracker.TraceQuery()
    .setStartDate(LocalDateTime.now().minusDays(7))    // 开始时间
    .setEndDate(LocalDateTime.now())                   // 结束时间
    .setEventType(MaterialTracker.TraceEventType.ISSUE) // 事件类型
    .setOperator("张三")                                // 操作员
    .setLimit(100);                                    // 限制数量
```


### 6.3 预警类型配置

```java
// 支持的预警类型
MaterialTracker.AlertType[] alertTypes = {
    MaterialTracker.AlertType.EXPIRATION_WARNING,  // 过期预警
    MaterialTracker.AlertType.INVENTORY_LOW,       // 库存不足
    MaterialTracker.AlertType.QUALITY_ISSUE,       // 质量问题
    MaterialTracker.AlertType.SUPPLIER_PROBLEM     // 供应商问题
};
```


## 7. 错误处理

### 7.1 异常处理示例

```java
public class MaterialTrackerErrorHandler {
    public void handleMaterialOperations() {
        try {
            // 创建物料
            MaterialTracker.Material material = MaterialTracker.createMaterial(
                "测试物料", 
                MaterialTracker.MaterialType.CUSTOM
            );
            
            if (material == null) {
                System.err.println("物料创建失败");
                return;
            }
            
            // 添加物料移动记录
            MaterialTracker.MaterialMovement movement = new MaterialTracker.MaterialMovement(
                material.getMaterialId(), 
                MaterialTracker.TraceEventType.RECEIPT, 
                1000.0
            );
            
            boolean added = MaterialTracker.addTraceMovement(material.getMaterialId(), movement);
            
            if (!added) {
                System.err.println("物料移动记录添加失败");
                
                // 记录详细错误信息
                System.err.println("可能的原因:");
                System.err.println("  1. 物料ID无效或不存在");
                System.err.println("  2. 系统缓存已满");
                System.err.println("  3. 数据库连接异常");
            } else {
                System.out.println("物料操作成功完成");
            }
            
        } catch (Exception e) {
            System.err.println("物料操作过程中发生异常: " + e.getMessage());
            
            // 根据异常类型进行不同处理
            if (e instanceof IllegalArgumentException) {
                System.err.println("输入参数错误");
            } else if (e instanceof IllegalStateException) {
                System.err.println("状态错误");
            } else {
                System.err.println("未知错误，请联系技术支持");
            }
            
            // 记录详细错误信息
            e.printStackTrace();
        }
    }
    
    public boolean safeMaterialOperation(String materialId, double quantity) {
        try {
            MaterialTracker.Material material = MaterialTracker.getMaterial(materialId);
            if (material == null) {
                System.err.println("物料未找到: " + materialId);
                return false;
            }
            
            // 检查库存是否充足
            Double currentQuantity = (Double) material.getAttribute("current_quantity");
            if (currentQuantity == null || currentQuantity < quantity) {
                System.err.println("库存不足: 当前库存 " + currentQuantity + ", 需要 " + quantity);
                return false;
            }
            
            // 执行操作
            MaterialTracker.MaterialMovement movement = new MaterialTracker.MaterialMovement(
                materialId, 
                MaterialTracker.TraceEventType.ISSUE, 
                quantity
            );
            
            return MaterialTracker.addTraceMovement(materialId, movement);
        } catch (Exception e) {
            System.err.println("安全物料操作失败: " + e.getMessage());
            return false;
        }
    }
}
```


## 8. 最佳实践

### 8.1 物料数据管理最佳实践

```java
public class MaterialDataManager {
    public boolean validateAndCreateMaterial(String materialName, 
                                         MaterialTracker.MaterialType materialType, 
                                         Map<String, Object> attributes) {
        // 1. 输入验证
        if (materialName == null || materialName.trim().isEmpty()) {
            System.err.println("物料名称不能为空");
            return false;
        }
        
        if (materialType == null) {
            System.err.println("物料类型不能为空");
            return false;
        }
        
        // 2. 创建物料
        MaterialTracker.Material material = MaterialTracker.createMaterial(materialName, materialType);
        
        if (material == null) {
            System.err.println("物料创建失败");
            return false;
        }
        
        // 3. 设置属性
        if (attributes != null) {
            attributes.forEach((key, value) -> {
                if (key != null && value != null) {
                    material.setAttribute(key, value);
                }
            });
        }
        
        // 4. 设置默认值
        material.setUnit(materialType == MaterialTracker.MaterialType.GOLD_WIRE ? "米" : "件")
               .setQualityStatus(MaterialTracker.QualityStatus.PENDING)
               .setStatus(MaterialTracker.MaterialStatus.AVAILABLE);
        
        // 5. 更新物料信息
        boolean updated = MaterialTracker.updateMaterial(material);
        if (updated) {
            System.out.println("物料创建成功: " + material.getMaterialId());
            return true;
        } else {
            System.err.println("物料信息更新失败");
            return false;
        }
    }
    
    public List<MaterialTracker.Material> batchCreateMaterials(
            List<MaterialCreationRequest> requests) {
        List<MaterialTracker.Material> createdMaterials = new ArrayList<>();
        
        for (MaterialCreationRequest request : requests) {
            try {
                MaterialTracker.Material material = MaterialTracker.createMaterial(
                    request.getMaterialName(),
                    request.getMaterialType()
                );
                
                if (material != null) {
                    // 设置属性
                    if (request.getAttributes() != null) {
                        request.getAttributes().forEach(material::setAttribute);
                    }
                    
                    // 设置标准信息
                    if (request.getSpecification() != null) {
                        material.setSpecification(request.getSpecification());
                    }
                    
                    if (request.getSupplier() != null) {
                        material.setSupplier(request.getSupplier());
                    }
                    
                    if (request.getLotNumber() != null) {
                        material.setLotNumber(request.getLotNumber());
                    }
                    
                    material.setUnit(request.getUnit() != null ? request.getUnit() : "件")
                           .setManufactureDate(request.getManufactureDate())
                           .setExpirationDate(request.getExpirationDate());
                    
                    boolean updated = MaterialTracker.updateMaterial(material);
                    if (updated) {
                        createdMaterials.add(material);
                        System.out.println("批量创建物料成功: " + material.getMaterialId());
                    } else {
                        System.err.println("批量创建物料失败: " + request.getMaterialName());
                    }
                } else {
                    System.err.println("批量创建物料失败: " + request.getMaterialName());
                }
            } catch (Exception e) {
                System.err.println("创建物料时发生错误: " + e.getMessage());
            }
        }
        
        return createdMaterials;
    }
    
    // 物料创建请求类
    public static class MaterialCreationRequest {
        private String materialName;
        private MaterialTracker.MaterialType materialType;
        private String specification;
        private String supplier;
        private String lotNumber;
        private String unit;
        private LocalDateTime manufactureDate;
        private LocalDateTime expirationDate;
        private Map<String, Object> attributes;
        
        public MaterialCreationRequest(String materialName, MaterialTracker.MaterialType materialType) {
            this.materialName = materialName;
            this.materialType = materialType;
            this.attributes = new HashMap<>();
        }
        
        // Getters and Setters
        public String getMaterialName() { return materialName; }
        public void setMaterialName(String materialName) { this.materialName = materialName; }
        
        public MaterialTracker.MaterialType getMaterialType() { return materialType; }
        public void setMaterialType(MaterialTracker.MaterialType materialType) { this.materialType = materialType; }
        
        public String getSpecification() { return specification; }
        public void setSpecification(String specification) { this.specification = specification; }
        
        public String getSupplier() { return supplier; }
        public void setSupplier(String supplier) { this.supplier = supplier; }
        
        public String getLotNumber() { return lotNumber; }
        public void setLotNumber(String lotNumber) { this.lotNumber = lotNumber; }
        
        public String getUnit() { return unit; }
        public void setUnit(String unit) { this.unit = unit; }
        
        public LocalDateTime getManufactureDate() { return manufactureDate; }
        public void setManufactureDate(LocalDateTime manufactureDate) { this.manufactureDate = manufactureDate; }
        
        public LocalDateTime getExpirationDate() { return expirationDate; }
        public void setExpirationDate(LocalDateTime expirationDate) { this.expirationDate = expirationDate; }
        
        public Map<String, Object> getAttributes() { return attributes; }
        public void setAttribute(String key, Object value) { this.attributes.put(key, value); }
    }
}
```


### 8.2 性能优化实践

```java
public class MaterialTrackerPerformanceOptimizer {
    private final Map<String, MaterialTracker.Material> materialCache = new ConcurrentHashMap<>();
    private final long cacheTimeout = 600000; // 10分钟
    
    public MaterialTracker.Material getCachedMaterial(String materialId) {
        // 检查本地缓存
        CachedMaterial cached = (CachedMaterial) materialCache.get(materialId);
        
        if (cached != null && !cached.isExpired()) {
            System.out.println("从本地缓存获取物料: " + materialId);
            return cached.getMaterial();
        }
        
        // 从管理器获取
        MaterialTracker.Material material = MaterialTracker.getMaterial(materialId);
        
        // 更新本地缓存
        if (material != null) {
            materialCache.put(materialId, new CachedMaterial(material, System.currentTimeMillis() + cacheTimeout));
        }
        
        return material;
    }
    
    public void batchUpdateMaterialStatus(List<String> materialIds, 
                                       MaterialTracker.MaterialStatus newStatus,
                                       String description) {
        ExecutorService executor = Executors.newFixedThreadPool(10);
        List<Future<Boolean>> futures = new ArrayList<>();
        
        for (String materialId : materialIds) {
            Future<Boolean> future = executor.submit(() -> {
                try {
                    MaterialTracker.Material material = MaterialTracker.getMaterial(materialId);
                    if (material != null) {
                        material.setStatus(newStatus);
                        return MaterialTracker.updateMaterial(material);
                    }
                    return false;
                } catch (Exception e) {
                    System.err.println("更新物料状态时发生错误: " + e.getMessage());
                    return false;
                }
            });
            futures.add(future);
        }
        
        // 等待所有更新完成
        int successCount = 0;
        for (int i = 0; i < futures.size(); i++) {
            try {
                if (futures.get(i).get(30, TimeUnit.SECONDS)) {
                    successCount++;
                }
            } catch (Exception e) {
                System.err.println("更新物料 " + materialIds.get(i) + " 状态时发生错误: " + e.getMessage());
            }
        }
        
        executor.shutdown();
        System.out.println("批量状态更新完成: " + successCount + "/" + materialIds.size() + " 成功");
    }
    
    // 缓存物料类
    private static class CachedMaterial {
        private final MaterialTracker.Material material;
        private final long expireTime;
        
        public CachedMaterial(MaterialTracker.Material material, long expireTime) {
            this.material = material;
            this.expireTime = expireTime;
        }
        
        public MaterialTracker.Material getMaterial() { return material; }
        public boolean isExpired() { return System.currentTimeMillis() > expireTime; }
    }
}
```


## 9. 系统集成

### 9.1 与Web服务集成

```java
@RestController
@RequestMapping("/api/materials")
public class MaterialTrackerWebService {
    
    @PostMapping("/create")
    public ResponseEntity<?> createMaterial(@RequestBody MaterialCreationRequest request) {
        try {
            MaterialTracker.Material material = MaterialTracker.createMaterial(
                request.getMaterialName(),
                MaterialTracker.MaterialType.valueOf(request.getMaterialType())
            );
            
            if (material != null) {
                // 设置属性
                if (request.getAttributes() != null) {
                    request.getAttributes().forEach((key, value) -> {
                        if (key != null && value != null) {
                            material.setAttribute(key, value.toString());
                        }
                    });
                }
                
                // 设置标准信息
                if (request.getSpecification() != null) {
                    material.setSpecification(request.getSpecification());
                }
                
                if (request.getSupplier() != null) {
                    material.setSupplier(request.getSupplier());
                }
                
                if (request.getLotNumber() != null) {
                    material.setLotNumber(request.getLotNumber());
                }
                
                material.setUnit(request.getUnit() != null ? request.getUnit() : "件")
                       .setManufactureDate(request.getManufactureDate())
                       .setExpirationDate(request.getExpirationDate());
                
                boolean updated = MaterialTracker.updateMaterial(material);
                if (updated) {
                    return ResponseEntity.ok(convertToResponse(material));
                } else {
                    return ResponseEntity.badRequest().body("物料信息更新失败");
                }
            } else {
                return ResponseEntity.badRequest().body("物料创建失败");
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("服务器内部错误: " + e.getMessage());
        }
    }
    
    @PostMapping("/{materialId}/trace")
    public ResponseEntity<?> traceMaterial(@PathVariable String materialId) {
        try {
            MaterialTracker.MaterialTrace trace = MaterialTracker.traceMaterial(materialId);
            
            if (trace != null) {
                return ResponseEntity.ok(convertToResponse(trace));
            } else {
                return ResponseEntity.notFound().build();
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("生成物料追溯失败: " + e.getMessage());
        }
    }
    
    @GetMapping("/{materialId}/quality")
    public ResponseEntity<?> getMaterialQualityStatus(@PathVariable String materialId) {
        try {
            MaterialTracker.QualityStatus status = MaterialTracker.getMaterialQualityStatus(materialId);
            return ResponseEntity.ok(new QualityStatusResponse(status.name(), status.getDescription()));
        } catch (Exception e) {
            return ResponseEntity.status(500).body("查询质量状态失败: " + e.getMessage());
        }
    }
    
    @GetMapping("/{materialId}/expiration")
    public ResponseEntity<?> checkMaterialExpiration(@PathVariable String materialId) {
        try {
            MaterialTracker.ExpirationAlert alert = MaterialTracker.checkMaterialExpiration(materialId);
            
            if (alert != null) {
                return ResponseEntity.ok(convertToResponse(alert));
            } else {
                return ResponseEntity.ok(new NoAlertResponse("无过期风险"));
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("检查物料过期失败: " + e.getMessage());
        }
    }
    
    @GetMapping("/{materialId}/inventory")
    public ResponseEntity<?> checkInventoryLevel(@PathVariable String materialId) {
        try {
            MaterialTracker.InventoryAlert alert = MaterialTracker.checkInventoryLevel(materialId);
            
            if (alert != null) {
                return ResponseEntity.ok(convertToResponse(alert));
            } else {
                return ResponseEntity.ok(new NoAlertResponse("库存水平正常"));
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("检查库存水平失败: " + e.getMessage());
        }
    }
    
    // 请求和响应类
    public static class MaterialCreationRequest {
        private String materialName;
        private String materialType;
        private String specification;
        private String supplier;
        private String lotNumber;
        private String unit;
        private LocalDateTime manufactureDate;
        private LocalDateTime expirationDate;
        private Map<String, Object> attributes;
        
        // Getters and Setters
        public String getMaterialName() { return materialName; }
        public void setMaterialName(String materialName) { this.materialName = materialName; }
        
        public String getMaterialType() { return materialType; }
        public void setMaterialType(String materialType) { this.materialType = materialType; }
        
        public String getSpecification() { return specification; }
        public void setSpecification(String specification) { this.specification = specification; }
        
        public String getSupplier() { return supplier; }
        public void setSupplier(String supplier) { this.supplier = supplier; }
        
        public String getLotNumber() { return lotNumber; }
        public void setLotNumber(String lotNumber) { this.lotNumber = lotNumber; }
        
        public String getUnit() { return unit; }
        public void setUnit(String unit) { this.unit = unit; }
        
        public LocalDateTime getManufactureDate() { return manufactureDate; }
        public void setManufactureDate(LocalDateTime manufactureDate) { this.manufactureDate = manufactureDate; }
        
        public LocalDateTime getExpirationDate() { return expirationDate; }
        public void setExpirationDate(LocalDateTime expirationDate) { this.expirationDate = expirationDate; }
        
        public Map<String, Object> getAttributes() { return attributes; }
        public void setAttributes(Map<String, Object> attributes) { this.attributes = attributes; }
    }
    
    public static class QualityStatusResponse {
        private String status;
        private String description;
        
        public QualityStatusResponse(String status, String description) {
            this.status = status;
            this.description = description;
        }
        
        // Getters and Setters
        public String getStatus() { return status; }
        public void setStatus(String status) { this.status = status; }
        
        public String getDescription() { return description; }
        public void setDescription(String description) { this.description = description; }
    }
    
    public static class NoAlertResponse {
        private String message;
        
        public NoAlertResponse(String message) {
            this.message = message;
        }
        
        // Getters and Setters
        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }
    }
    
    // 转换方法
    private Object convertToResponse(MaterialTracker.Material material) {
        // 实现物料到响应对象的转换
        return new Object();
    }
    
    private Object convertToResponse(MaterialTracker.MaterialTrace trace) {
        // 实现物料追溯到响应对象的转换
        return new Object();
    }
    
    private Object convertToResponse(MaterialTracker.ExpirationAlert alert) {
        // 实现过期预警到响应对象的转换
        return new Object();
    }
    
    private Object convertToResponse(MaterialTracker.InventoryAlert alert) {
        // 实现库存预警到响应对象的转换
        return new Object();
    }
}
```


### 9.2 与调度系统集成

```java
@Component
public class ScheduledMaterialTasks {
    
    // 每小时检查物料有效期
    @Scheduled(fixedRate = 3600000) // 1小时
    public void checkMaterialExpirations() {
        System.out.println("开始检查物料有效期...");
        
        try {
            // 这里应该查询所有需要检查有效期的物料
            // 由于示例中没有实际的存储机制，这里只是演示
            
            System.out.println("物料有效期检查完成");
        } catch (Exception e) {
            System.err.println("物料有效期检查失败: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    // 每天检查库存水平
    @Scheduled(cron = "0 0 2 * * ?")
    public void checkInventoryLevels() {
        System.out.println("开始检查库存水平...");
        
        try {
            // 获取缓存统计信息
            MaterialTracker.CacheStatistics stats = MaterialTracker.getCacheStatistics();
            
            System.out.println("检查前缓存统计:");
            System.out.println("  物料缓存大小: " + stats.getMaterialCacheSize());
            System.out.println("  批次缓存大小: " + stats.getBatchCacheSize());
            
            // MaterialTracker内部会自动检查库存预警
            System.out.println("库存水平检查完成");
        } catch (Exception e) {
            System.err.println("库存水平检查失败: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    // 每周生成物料统计报告
    @Scheduled(cron = "0 0 3 * * MON") // 每周一凌晨3点
    public void generateWeeklyMaterialReport() {
        System.out.println("开始生成周物料统计报告...");
        
        try {
            LocalDateTime weekAgo = LocalDateTime.now().minusWeeks(1);
            
            // 这里应该查询上周的物料数据并生成报告
            // 由于示例中没有实际的存储机制，这里只是演示
            
            System.out.println("统计时间范围: " + weekAgo + " 到 " + LocalDateTime.now());
            System.out.println("周物料统计报告生成完成");
        } catch (Exception e) {
            System.err.println("周物料统计报告生成失败: " + e.getMessage());
            e.printStackTrace();
        }
    }
}
```


这个使用说明文档涵盖了 [MaterialTracker](file://E:\dossier\others\im-common\src\main\java\com\qtech\im\semiconductor\material\MaterialTracker.java#L34-L1563) 的主要功能和使用方法，可以帮助开发者快速上手并正确使用该物料追踪工具类。