# RecipeManager 使用说明文档

## 1. 概述

[RecipeManager](file://E:\dossier\others\im-common\src\main\java\com\qtech\im\semiconductor\process\recipe\RecipeManager.java#L34-L1771) 是一个专业的半导体工艺配方管理工具类，专门用于半导体封测行业的工艺配方加载、验证、参数优化、版本控制和审批流程管理。该工具解决了工艺配方版本管理混乱、工艺参数配置复杂、工艺配方验证困难和工艺配方追溯不完整等问题。

## 2. 核心功能

### 2.1 工艺配方加载和验证
- 支持多种存储方式加载配方
- 自动化配方验证机制
- 配方缓存管理

### 2.2 工艺参数优化
- 基于历史数据的参数优化
- 多种优化算法支持
- 优化结果评估

### 2.3 工艺配方版本控制
- 完整的版本历史追踪
- 版本比较和回滚
- 配方变更日志

### 2.4 工艺配方审批流程
- 多级审批机制
- 审批状态跟踪
- 审批意见记录

## 3. 支持的配方类型和参数

### 3.1 配方类型
```java
public enum RecipeType {
    WIRE_BONDING("引线键合工艺", "Wire Bonding Process"),      // 引线键合工艺
    DIE_ATTACH("芯片贴装工艺", "Die Attach Process"),         // 芯片贴装工艺
    PLASTIC_PACKAGING("塑封工艺", "Plastic Packaging Process"), // 塑封工艺
    METAL_PACKAGING("金属封装工艺", "Metal Packaging Process"), // 金属封装工艺
    CERAMIC_PACKAGING("陶瓷封装工艺", "Ceramic Packaging Process"), // 陶瓷封装工艺
    SOLDERING("焊接工艺", "Soldering Process"),              // 焊接工艺
    CLEANING("清洗工艺", "Cleaning Process"),                // 清洗工艺
    TESTING("测试工艺", "Testing Process"),                  // 测试工艺
    CUSTOM("自定义工艺", "Custom Process")                   // 自定义工艺
}
```


### 3.2 参数类型
```java
public enum ParameterType {
    TEMPERATURE("温度", "Temperature"),        // 温度参数
    PRESSURE("压力", "Pressure"),             // 压力参数
    TIME("时间", "Time"),                     // 时间参数
    SPEED("速度", "Speed"),                   // 速度参数
    VOLTAGE("电压", "Voltage"),               // 电压参数
    CURRENT("电流", "Current"),               // 电流参数
    FREQUENCY("频率", "Frequency"),           // 频率参数
    POWER("功率", "Power"),                   // 功率参数
    FLOW_RATE("流量", "Flow Rate"),           // 流量参数
    POSITION("位置", "Position"),             // 位置参数
    CUSTOM("自定义", "Custom")                // 自定义参数
}
```


### 3.3 配方状态
```java
public enum RecipeStatus {
    DRAFT("草稿", 1),           // 草稿状态
    SUBMITTED("已提交", 2),      // 已提交审批
    UNDER_REVIEW("审核中", 3),    // 审核中
    APPROVED("已批准", 4),       // 已批准
    REJECTED("已拒绝", 5),       // 已拒绝
    ACTIVE("激活", 6),           // 激活使用中
    DEPRECATED("已弃用", 7),      // 已弃用
    ARCHIVED("已归档", 8)        // 已归档
}
```


## 4. 基本使用方法

### 4.1 创建工艺配方

```java
// 创建新的工艺配方
RecipeManager.ProcessRecipe recipe = RecipeManager.createRecipe(
    "WB-Standard-001",                           // 配方名称
    RecipeManager.RecipeType.WIRE_BONDING,       // 配方类型
    "2.0"                                       // 版本号
);

if (recipe != null) {
    System.out.println("创建配方成功:");
    System.out.println("  配方ID: " + recipe.getRecipeId());
    System.out.println("  配方名称: " + recipe.getRecipeName());
    System.out.println("  配方类型: " + recipe.getRecipeType().getChineseName());
    System.out.println("  版本号: " + recipe.getVersion());
    System.out.println("  当前状态: " + recipe.getStatus().getDescription());
    
    // 设置配方描述
    recipe.setDescription("标准引线键合工艺配方");
    
    // 添加配方参数
    RecipeManager.RecipeParameter temperatureParam = new RecipeManager.RecipeParameter(
        "TEMP_001", 
        "键合温度", 
        RecipeManager.ParameterType.TEMPERATURE
    )
    .setDefaultValue(280.0)
    .setMinValue(250.0)
    .setMaxValue(320.0)
    .setUnit("°C")
    .setRequired(true)
    .setDescription("引线键合工艺温度参数");
    
    recipe.addParameter(temperatureParam);
    
    RecipeManager.RecipeParameter timeParam = new RecipeManager.RecipeParameter(
        "TIME_001", 
        "键合时间", 
        RecipeManager.ParameterType.TIME
    )
    .setDefaultValue(30.0)
    .setMinValue(10.0)
    .setMaxValue(60.0)
    .setUnit("ms")
    .setRequired(true)
    .setDescription("引线键合工艺时间参数");
    
    recipe.addParameter(timeParam);
    
    // 添加工艺步骤
    RecipeManager.RecipeStep step1 = new RecipeManager.RecipeStep("STEP_001", "预热", 1)
        .setDescription("设备预热到工作温度")
        .setParameter("target_temp", 280.0)
        .setDuration(5000); // 5秒
    
    recipe.addStep(step1);
    
    RecipeManager.RecipeStep step2 = new RecipeManager.RecipeStep("STEP_002", "键合", 2)
        .setDescription("执行引线键合工艺")
        .setParameter("bond_force", 50.0)
        .setParameter("ultrasonic_power", 75.0)
        .setDuration(30); // 30毫秒
    
    recipe.addStep(step2);
    
    System.out.println("配方参数数量: " + recipe.getParameters().size());
    System.out.println("工艺步骤数量: " + recipe.getSteps().size());
} else {
    System.err.println("配方创建失败");
}
```


### 4.2 工艺配方加载和验证

```java
// 加载工艺配方
RecipeManager.ProcessRecipe loadedRecipe = RecipeManager.loadRecipe(recipe.getRecipeId());

if (loadedRecipe != null) {
    System.out.println("加载配方成功:");
    System.out.println("  配方ID: " + loadedRecipe.getRecipeId());
    System.out.println("  配方名称: " + loadedRecipe.getRecipeName());
    System.out.println("  当前状态: " + loadedRecipe.getStatus().getDescription());
    
    // 显示配方参数
    System.out.println("  配方参数:");
    for (RecipeManager.RecipeParameter param : loadedRecipe.getParameters().values()) {
        System.out.println("    " + param.getParameterName() + 
                          " (" + param.getParameterType().getChineseName() + ")" +
                          ": 默认值=" + param.getDefaultValue() + 
                          " " + param.getUnit() + 
                          ", 范围=[" + param.getMinValue() + ", " + param.getMaxValue() + "]");
    }
    
    // 显示工艺步骤
    System.out.println("  工艺步骤:");
    for (RecipeManager.RecipeStep step : loadedRecipe.getSteps()) {
        System.out.println("    步骤" + step.getStepNumber() + ": " + step.getStepName() + 
                          " (" + step.getDuration() + "ms)");
    }
} else {
    System.err.println("配方加载失败");
}

// 验证配方
List<RecipeManager.ValidationError> validationErrors = RecipeManager.validateRecipe(loadedRecipe);

if (validationErrors.isEmpty()) {
    System.out.println("配方验证通过");
} else {
    System.out.println("配方验证发现 " + validationErrors.size() + " 个错误:");
    for (RecipeManager.ValidationError error : validationErrors) {
        System.out.println("  - [" + (error.isCritical() ? "严重" : "一般") + "] " + 
                          error.getErrorMessage() + 
                          (error.getField() != null && !error.getField().isEmpty() ? 
                           " (字段: " + error.getField() + ")" : ""));
    }
}
```


### 4.3 工艺参数优化

```java
// 准备历史数据用于参数优化
List<RecipeManager.DataPoint> dataPoints = new ArrayList<>();

// 添加高质量数据点
Map<String, Object> params1 = new HashMap<>();
params1.put("TEMP_001", 285.0);
params1.put("TIME_001", 28.0);
dataPoints.add(new RecipeManager.DataPoint(params1, 0.95, LocalDateTime.now().minusDays(1)));

Map<String, Object> params2 = new HashMap<>();
params2.put("TEMP_001", 282.0);
params2.put("TIME_001", 30.0);
dataPoints.add(new RecipeManager.DataPoint(params2, 0.92, LocalDateTime.now().minusDays(2)));

Map<String, Object> params3 = new HashMap<>();
params3.put("TEMP_001", 278.0);
params3.put("TIME_001", 32.0);
dataPoints.add(new RecipeManager.DataPoint(params3, 0.89, LocalDateTime.now().minusDays(3)));

RecipeManager.HistoricalData historicalData = new RecipeManager.HistoricalData(
    dataPoints,
    LocalDateTime.now().minusDays(7),
    LocalDateTime.now(),
    "PRODUCT_X"
);

// 执行参数优化
RecipeManager.OptimizedParameters optimizedParams = RecipeManager.optimizeParameters(
    loadedRecipe,
    historicalData
);

if (optimizedParams != null) {
    System.out.println("参数优化完成:");
    System.out.println("  优化算法: " + optimizedParams.getAlgorithm().getChineseName());
    System.out.println("  目标函数值: " + String.format("%.4f", optimizedParams.getObjectiveValue()));
    System.out.println("  是否收敛: " + optimizedParams.isConverged());
    System.out.println("  迭代次数: " + optimizedParams.getIterations());
    
    // 显示优化后的参数值
    System.out.println("  优化参数:");
    for (Map.Entry<String, Object> entry : optimizedParams.getOptimizedValues().entrySet()) {
        System.out.println("    " + entry.getKey() + ": " + entry.getValue());
    }
    
    // 显示统计信息
    System.out.println("  统计信息:");
    optimizedParams.getStatistics().forEach((key, value) -> 
        System.out.println("    " + key + ": " + value));
} else {
    System.err.println("参数优化失败");
}
```


### 4.4 工艺配方版本控制

```java
// 保存配方版本
boolean versionSaved = RecipeManager.saveRecipeVersion(loadedRecipe);

if (versionSaved) {
    System.out.println("配方版本保存成功: " + loadedRecipe.getRecipeId() + " - " + loadedRecipe.getVersion());
} else {
    System.err.println("配方版本保存失败");
}

// 获取配方版本历史
RecipeManager.RecipeVersionHistory versionHistory = RecipeManager.getRecipeHistory(loadedRecipe.getRecipeId());

if (versionHistory != null) {
    System.out.println("配方版本历史:");
    System.out.println("  配方ID: " + versionHistory.getRecipeId());
    System.out.println("  版本数量: " + versionHistory.getVersions().size());
    System.out.println("  最后更新: " + versionHistory.getLastUpdated());
    
    // 显示各个版本
    for (RecipeManager.RecipeVersion version : versionHistory.getVersions()) {
        System.out.println("    版本 " + version.getVersionNumber() + 
                          " (" + version.getStatus().getDescription() + ")" +
                          " - 创建时间: " + version.getCreateTime());
    }
} else {
    System.err.println("获取配方版本历史失败");
}

// 获取特定版本的配方
RecipeManager.ProcessRecipe versionedRecipe = RecipeManager.getRecipeVersion(
    loadedRecipe.getRecipeId(), 
    "1.0"
);

if (versionedRecipe != null) {
    System.out.println("获取版本成功:");
    System.out.println("  版本号: " + versionedRecipe.getVersion());
    System.out.println("  状态: " + versionedRecipe.getStatus().getDescription());
} else {
    System.err.println("获取特定版本失败");
}
```


### 4.5 工艺配方审批流程

```java
// 提交配方审批
boolean submitted = RecipeManager.submitRecipeForApproval(loadedRecipe);

if (submitted) {
    System.out.println("配方提交审批成功: " + loadedRecipe.getRecipeId());
    System.out.println("当前状态: " + loadedRecipe.getStatus().getDescription());
} else {
    System.err.println("配方提交审批失败");
}

// 获取审批工作流
RecipeManager.ApprovalWorkflow workflow = RecipeManager.getApprovalWorkflow(loadedRecipe.getRecipeId());

if (workflow != null) {
    System.out.println("审批工作流:");
    System.out.println("  工作流ID: " + workflow.getWorkflowId());
    System.out.println("  配方ID: " + workflow.getRecipeId());
    System.out.println("  状态: " + workflow.getStatus().getChineseName());
    System.out.println("  发起人: " + workflow.getInitiator());
    System.out.println("  创建时间: " + workflow.getCreateTime());
    System.out.println("  步骤数量: " + workflow.getSteps().size());
    
    // 显示审批步骤
    for (RecipeManager.ApprovalStep step : workflow.getSteps()) {
        System.out.println("    审批人: " + step.getApprover() + 
                          " (" + step.getRole() + ")" +
                          " - 状态: " + step.getStatus().getChineseName() +
                          ", 分配时间: " + step.getAssignTime());
    }
} else {
    System.err.println("获取审批工作流失败");
}

// 批准配方（示例）
boolean approved = RecipeManager.approveRecipe(
    loadedRecipe.getRecipeId(), 
    "张经理", 
    "配方参数合理，符合工艺要求"
);

if (approved) {
    System.out.println("配方批准成功: " + loadedRecipe.getRecipeId());
} else {
    System.err.println("配方批准失败");
}

// 拒绝配方（示例）
boolean rejected = RecipeManager.rejectRecipe(
    loadedRecipe.getRecipeId(), 
    "李主任", 
    "温度参数范围过大，需要调整"
);

if (rejected) {
    System.out.println("配方拒绝成功: " + loadedRecipe.getRecipeId());
} else {
    System.err.println("配方拒绝失败");
}
```


## 5. 高级使用示例

### 5.1 完整的配方管理流程

```java
public class CompleteRecipeManagement {
    public void manageCompleteRecipeLifecycle() {
        try {
            System.out.println("=== 开始完整配方管理流程 ===");
            
            // 1. 创建配方
            System.out.println("步骤1: 创建配方");
            RecipeManager.ProcessRecipe recipe = createNewRecipe();
            
            if (recipe == null) {
                System.err.println("配方创建失败");
                return;
            }
            
            // 2. 配方验证
            System.out.println("\n步骤2: 配方验证");
            validateRecipe(recipe);
            
            // 3. 参数优化
            System.out.println("\n步骤3: 参数优化");
            optimizeRecipeParameters(recipe);
            
            // 4. 保存版本
            System.out.println("\n步骤4: 保存版本");
            saveRecipeVersion(recipe);
            
            // 5. 提交审批
            System.out.println("\n步骤5: 提交审批");
            submitForApproval(recipe);
            
            // 6. 审批处理
            System.out.println("\n步骤6: 审批处理");
            processApproval(recipe);
            
            // 7. 版本历史查询
            System.out.println("\n步骤7: 版本历史查询");
            queryVersionHistory(recipe);
            
            System.out.println("\n=== 配方管理流程完成 ===");
            
        } catch (Exception e) {
            System.err.println("配方管理流程中发生错误: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    private RecipeManager.ProcessRecipe createNewRecipe() {
        // 创建新的塑封工艺配方
        RecipeManager.ProcessRecipe recipe = RecipeManager.createRecipe(
            "Molding-Standard-001",
            RecipeManager.RecipeType.PLASTIC_PACKAGING,
            "1.0"
        );
        
        if (recipe != null) {
            recipe.setDescription("标准塑封工艺配方")
                  .setEquipmentType("Molding Machine Type-A");
            
            // 添加温度参数
            recipe.addParameter(new RecipeManager.RecipeParameter("MOLD_TEMP", "模具温度", 
                                                                 RecipeManager.ParameterType.TEMPERATURE)
                               .setDefaultValue(175.0)
                               .setMinValue(160.0)
                               .setMaxValue(190.0)
                               .setUnit("°C")
                               .setRequired(true)
                               .setDescription("塑封模具工作温度"));
            
            // 添加压力参数
            recipe.addParameter(new RecipeManager.RecipeParameter("INJECTION_PRESSURE", "注射压力", 
                                                                 RecipeManager.ParameterType.PRESSURE)
                               .setDefaultValue(80.0)
                               .setMinValue(60.0)
                               .setMaxValue(100.0)
                               .setUnit("MPa")
                               .setRequired(true)
                               .setDescription("塑封注射压力"));
            
            // 添加时间参数
            recipe.addParameter(new RecipeManager.RecipeParameter("CURING_TIME", "固化时间", 
                                                                 RecipeManager.ParameterType.TIME)
                               .setDefaultValue(180.0)
                               .setMinValue(120.0)
                               .setMaxValue(240.0)
                               .setUnit("秒")
                               .setRequired(true)
                               .setDescription("塑封固化时间"));
            
            // 添加工艺步骤
            recipe.addStep(new RecipeManager.RecipeStep("STEP_001", "预热", 1)
                          .setDescription("模具预热到工作温度")
                          .setParameter("target_temp", 175.0)
                          .setDuration(300000)); // 5分钟
            
            recipe.addStep(new RecipeManager.RecipeStep("STEP_002", "注射", 2)
                          .setDescription("执行塑封注射")
                          .setParameter("injection_speed", 50.0)
                          .setParameter("injection_pressure", 80.0)
                          .setDuration(10000)); // 10秒
            
            recipe.addStep(new RecipeManager.RecipeStep("STEP_003", "固化", 3)
                          .setDescription("塑封料固化")
                          .setParameter("holding_pressure", 60.0)
                          .setDuration(180000)); // 3分钟
            
            System.out.println("配方创建成功: " + recipe.getRecipeId() + " - " + recipe.getRecipeName());
        }
        
        return recipe;
    }
    
    private void validateRecipe(RecipeManager.ProcessRecipe recipe) {
        List<RecipeManager.ValidationError> errors = RecipeManager.validateRecipe(recipe);
        
        if (errors.isEmpty()) {
            System.out.println("配方验证通过");
        } else {
            System.out.println("配方验证发现 " + errors.size() + " 个错误:");
            for (RecipeManager.ValidationError error : errors) {
                System.out.println("  - [" + (error.isCritical() ? "严重" : "一般") + "] " + 
                                  error.getErrorMessage());
            }
        }
    }
    
    private void optimizeRecipeParameters(RecipeManager.ProcessRecipe recipe) {
        // 创建模拟历史数据
        List<RecipeManager.DataPoint> dataPoints = new ArrayList<>();
        
        // 添加高质量数据点
        for (int i = 0; i < 20; i++) {
            Map<String, Object> params = new HashMap<>();
            params.put("MOLD_TEMP", 170.0 + Math.random() * 10);
            params.put("INJECTION_PRESSURE", 75.0 + Math.random() * 10);
            params.put("CURING_TIME", 170.0 + Math.random() * 20);
            
            double qualityScore = 0.85 + Math.random() * 0.15; // 85-100% 质量分数
            dataPoints.add(new RecipeManager.DataPoint(params, qualityScore, 
                                                     LocalDateTime.now().minusDays(i)));
        }
        
        RecipeManager.HistoricalData historicalData = new RecipeManager.HistoricalData(
            dataPoints,
            LocalDateTime.now().minusDays(30),
            LocalDateTime.now(),
            "PRODUCT_Y"
        );
        
        // 执行优化
        RecipeManager.OptimizedParameters optimizedParams = RecipeManager.optimizeParameters(
            recipe, 
            historicalData,
            RecipeManager.OptimizationAlgorithm.GENETIC_ALGORITHM
        );
        
        if (optimizedParams != null) {
            System.out.println("参数优化完成:");
            optimizedParams.getOptimizedValues().forEach((param, value) -> 
                System.out.println("  " + param + ": " + value));
        } else {
            System.err.println("参数优化失败");
        }
    }
    
    private void saveRecipeVersion(RecipeManager.ProcessRecipe recipe) {
        boolean saved = RecipeManager.saveRecipeVersion(recipe);
        
        if (saved) {
            System.out.println("配方版本保存成功: " + recipe.getVersion());
        } else {
            System.err.println("配方版本保存失败");
        }
    }
    
    private void submitForApproval(RecipeManager.ProcessRecipe recipe) {
        boolean submitted = RecipeManager.submitRecipeForApproval(recipe);
        
        if (submitted) {
            System.out.println("配方提交审批成功");
            System.out.println("当前状态: " + recipe.getStatus().getDescription());
        } else {
            System.err.println("配方提交审批失败");
        }
    }
    
    private void processApproval(RecipeManager.ProcessRecipe recipe) {
        // 模拟审批流程
        RecipeManager.ApprovalWorkflow workflow = RecipeManager.getApprovalWorkflow(recipe.getRecipeId());
        
        if (workflow != null) {
            System.out.println("审批工作流状态: " + workflow.getStatus().getChineseName());
            
            // 模拟批准
            boolean approved = RecipeManager.approveRecipe(
                recipe.getRecipeId(),
                "工艺工程师",
                "参数设置合理，符合质量要求"
            );
            
            if (approved) {
                System.out.println("配方已批准，可以投入使用");
                RecipeManager.ProcessRecipe updatedRecipe = RecipeManager.loadRecipe(recipe.getRecipeId());
                if (updatedRecipe != null) {
                    System.out.println("更新后状态: " + updatedRecipe.getStatus().getDescription());
                }
            }
        }
    }
    
    private void queryVersionHistory(RecipeManager.ProcessRecipe recipe) {
        RecipeManager.RecipeVersionHistory history = RecipeManager.getRecipeHistory(recipe.getRecipeId());
        
        if (history != null) {
            System.out.println("配方版本历史:");
            System.out.println("  总版本数: " + history.getVersions().size());
            
            for (RecipeManager.RecipeVersion version : history.getVersions()) {
                System.out.println("  - 版本 " + version.getVersionNumber() + 
                                  " (" + version.getStatus().getDescription() + ")" +
                                  " 创建于 " + version.getCreateTime());
            }
        }
    }
}
```


### 5.2 配方查询和分析

```java
public class RecipeQueryAndAnalysis {
    public void queryAndAnalyzeRecipes() {
        try {
            System.out.println("=== 配方查询和分析 ===");
            
            // 创建查询条件
            RecipeManager.RecipeQuery query = new RecipeManager.RecipeQuery()
                .setRecipeType(RecipeManager.RecipeType.WIRE_BONDING)
                .setStatus(RecipeManager.RecipeStatus.ACTIVE)
                .setStartDate(LocalDateTime.now().minusMonths(6))
                .setPageSize(20)
                .setSortBy("createTime")
                .setAscending(false);
            
            // 执行查询
            List<RecipeManager.ProcessRecipe> recipes = RecipeManager.queryRecipes(query);
            
            System.out.println("查询到 " + recipes.size() + " 个配方:");
            
            // 统计分析
            performStatisticalAnalysis(recipes);
            
            // 显示详细信息
            displayRecipeDetails(recipes);
            
        } catch (Exception e) {
            System.err.println("配方查询和分析过程中发生错误: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    private void performStatisticalAnalysis(List<RecipeManager.ProcessRecipe> recipes) {
        if (recipes.isEmpty()) {
            System.out.println("没有配方数据可供分析");
            return;
        }
        
        System.out.println("统计分析结果:");
        
        // 按类型统计
        Map<RecipeManager.RecipeType, Long> typeCount = recipes.stream()
            .collect(Collectors.groupingBy(
                RecipeManager.ProcessRecipe::getRecipeType,
                Collectors.counting()
            ));
        
        System.out.println("  类型分布:");
        typeCount.forEach((type, count) -> 
            System.out.println("    " + type.getChineseName() + ": " + count));
        
        // 按状态统计
        Map<RecipeManager.RecipeStatus, Long> statusCount = recipes.stream()
            .collect(Collectors.groupingBy(
                RecipeManager.ProcessRecipe::getStatus,
                Collectors.counting()
            ));
        
        System.out.println("  状态分布:");
        statusCount.forEach((status, count) -> 
            System.out.println("    " + status.getDescription() + ": " + count));
        
        // 按创建时间统计
        Map<String, Long> monthlyCount = recipes.stream()
            .collect(Collectors.groupingBy(
                recipe -> recipe.getCreateTime().toLocalDate().withDayOfMonth(1).toString(),
                Collectors.counting()
            ));
        
        System.out.println("  月度创建数量:");
        monthlyCount.entrySet().stream()
            .sorted(Map.Entry.comparingByKey())
            .forEach(entry -> 
                System.out.println("    " + entry.getKey() + ": " + entry.getValue()));
    }
    
    private void displayRecipeDetails(List<RecipeManager.ProcessRecipe> recipes) {
        System.out.println("配方详细信息:");
        
        recipes.stream()
            .limit(5) // 只显示前5个配方
            .forEach(recipe -> {
                System.out.println("  配方ID: " + recipe.getRecipeId());
                System.out.println("    名称: " + recipe.getRecipeName());
                System.out.println("    类型: " + recipe.getRecipeType().getChineseName());
                System.out.println("    版本: " + recipe.getVersion());
                System.out.println("    状态: " + recipe.getStatus().getDescription());
                System.out.println("    创建时间: " + recipe.getCreateTime());
                System.out.println("    参数数量: " + recipe.getParameters().size());
                System.out.println("    步骤数量: " + recipe.getSteps().size());
                
                // 显示部分参数
                System.out.println("    主要参数:");
                recipe.getParameters().values().stream()
                    .limit(3)
                    .forEach(param -> 
                        System.out.println("      " + param.getParameterName() + 
                                         ": " + param.getDefaultValue() + " " + param.getUnit()));
                
                System.out.println();
            });
    }
    
    public void analyzeRecipeParameters(String recipeId) {
        try {
            System.out.println("=== 配方参数分析: " + recipeId + " ===");
            
            RecipeManager.ProcessRecipe recipe = RecipeManager.loadRecipe(recipeId);
            
            if (recipe == null) {
                System.err.println("配方未找到: " + recipeId);
                return;
            }
            
            System.out.println("配方信息:");
            System.out.println("  名称: " + recipe.getRecipeName());
            System.out.println("  类型: " + recipe.getRecipeType().getChineseName());
            System.out.println("  版本: " + recipe.getVersion());
            System.out.println("  状态: " + recipe.getStatus().getDescription());
            
            System.out.println("参数详情:");
            for (RecipeManager.RecipeParameter param : recipe.getParameters().values()) {
                System.out.println("  " + param.getParameterName() + 
                                 " (" + param.getParameterType().getChineseName() + ")");
                System.out.println("    默认值: " + param.getDefaultValue());
                System.out.println("    范围: [" + param.getMinValue() + ", " + param.getMaxValue() + "] " + param.getUnit());
                System.out.println("    必需: " + (param.isRequired() ? "是" : "否"));
                System.out.println("    描述: " + param.getDescription());
                
                if (!param.getAttributes().isEmpty()) {
                    System.out.println("    属性:");
                    param.getAttributes().forEach((key, value) -> 
                        System.out.println("      " + key + ": " + value));
                }
                
                System.out.println();
            }
            
            System.out.println("工艺步骤:");
            for (RecipeManager.RecipeStep step : recipe.getSteps()) {
                System.out.println("  步骤" + step.getStepNumber() + ": " + step.getStepName());
                System.out.println("    描述: " + step.getDescription());
                System.out.println("    持续时间: " + step.getDuration() + "ms");
                
                if (!step.getParameters().isEmpty()) {
                    System.out.println("    参数:");
                    step.getParameters().forEach((key, value) -> 
                        System.out.println("      " + key + ": " + value));
                }
                
                if (!step.getDependencies().isEmpty()) {
                    System.out.println("    依赖: " + String.join(", ", step.getDependencies()));
                }
                
                System.out.println();
            }
            
        } catch (Exception e) {
            System.err.println("配方参数分析过程中发生错误: " + e.getMessage());
            e.printStackTrace();
        }
    }
}
```


## 6. 配置参数详解

### 6.1 系统级配置参数

```java
public class RecipeManagerConfig {
    // 缓存超时时间（毫秒）
    public static final long CACHE_TIMEOUT = 30 * 60 * 1000; // 30分钟
    
    // 最大版本数
    public static final int MAX_VERSIONS = 50;
    
    // 最大重试次数
    public static final int MAX_RETRY_ATTEMPTS = 3;
    
    // 重试延迟（毫秒）
    public static final long RETRY_DELAY = 1000; // 1秒
    
    // 优化迭代次数
    public static final int OPTIMIZATION_ITERATIONS = 100;
    
    // 收敛阈值
    public static final double CONVERGENCE_THRESHOLD = 0.001;
}
```


### 6.2 配方查询配置

```java
RecipeManager.RecipeQuery query = new RecipeManager.RecipeQuery()
    .setRecipeType(RecipeManager.RecipeType.PLASTIC_PACKAGING)  // 配方类型过滤
    .setStatus(RecipeManager.RecipeStatus.ACTIVE)               // 状态过滤
    .setStartDate(LocalDateTime.now().minusDays(30))            // 开始时间
    .setEndDate(LocalDateTime.now())                           // 结束时间
    .setKeyword("标准")                                         // 关键字搜索
    .setPage(1)                                                // 页码
    .setPageSize(50)                                           // 每页数量
    .setSortBy("createTime")                                   // 排序字段
    .setAscending(false);                                      // 是否升序
```


### 6.3 优化算法配置

```java
// 支持的优化算法
RecipeManager.OptimizationAlgorithm[] algorithms = {
    RecipeManager.OptimizationAlgorithm.GENETIC_ALGORITHM,      // 遗传算法
    RecipeManager.OptimizationAlgorithm.SIMULATED_ANNEALING,    // 模拟退火
    RecipeManager.OptimizationAlgorithm.PARTICLE_SWARM,         // 粒子群优化
    RecipeManager.OptimizationAlgorithm.GRADIENT_DESCENT,       // 梯度下降
    RecipeManager.OptimizationAlgorithm.BAYESIAN_OPTIMIZATION   // 贝叶斯优化
};

// 设置当前优化器
RecipeManager.setCurrentOptimizer(RecipeManager.OptimizationAlgorithm.GENETIC_ALGORITHM);
```


## 7. 错误处理

### 7.1 异常处理示例

```java
public class RecipeManagerErrorHandler {
    public void handleRecipeOperations() {
        try {
            // 执行配方操作
            RecipeManager.ProcessRecipe recipe = RecipeManager.createRecipe(
                "Test-Recipe-001",
                RecipeManager.RecipeType.CUSTOM,
                "1.0"
            );
            
            if (recipe == null) {
                System.err.println("配方创建失败");
                return;
            }
            
            // 验证配方
            List<RecipeManager.ValidationError> errors = RecipeManager.validateRecipe(recipe);
            if (errors.stream().anyMatch(RecipeManager.ValidationError::isCritical)) {
                System.err.println("配方存在严重错误，无法继续");
                return;
            }
            
            // 保存配方
            boolean saved = RecipeManager.saveRecipeVersion(recipe);
            if (!saved) {
                System.err.println("配方保存失败");
                return;
            }
            
            System.out.println("所有配方操作成功完成");
            
        } catch (Exception e) {
            System.err.println("配方操作过程中发生异常: " + e.getMessage());
            
            // 根据异常类型进行不同处理
            if (e instanceof IllegalArgumentException) {
                System.err.println("输入参数错误");
            } else if (e instanceof IllegalStateException) {
                System.err.println("状态错误");
            } else {
                System.err.println("未知错误，请联系技术支持");
            }
            
            // 记录详细错误信息
            e.printStackTrace();
        }
    }
    
    public boolean safeRecipeOperation(String recipeId) {
        try {
            RecipeManager.ProcessRecipe recipe = RecipeManager.loadRecipe(recipeId);
            if (recipe == null) {
                System.err.println("配方未找到: " + recipeId);
                return false;
            }
            
            // 执行操作
            return RecipeManager.submitRecipeForApproval(recipe);
        } catch (Exception e) {
            System.err.println("安全配方操作失败: " + e.getMessage());
            return false;
        }
    }
}
```


## 8. 最佳实践

### 8.1 配方数据管理最佳实践

```java
public class RecipeDataManager {
    public boolean validateAndCreateRecipe(String recipeName, 
                                        RecipeManager.RecipeType recipeType, 
                                        String version,
                                        Map<String, Object> attributes) {
        // 1. 输入验证
        if (recipeName == null || recipeName.trim().isEmpty()) {
            System.err.println("配方名称不能为空");
            return false;
        }
        
        if (recipeType == null) {
            System.err.println("配方类型不能为空");
            return false;
        }
        
        if (version == null || version.trim().isEmpty()) {
            System.err.println("版本号不能为空");
            return false;
        }
        
        // 2. 创建配方
        RecipeManager.ProcessRecipe recipe = RecipeManager.createRecipe(recipeName, recipeType, version);
        
        if (recipe == null) {
            System.err.println("配方创建失败");
            return false;
        }
        
        // 3. 设置属性
        if (attributes != null) {
            attributes.forEach((key, value) -> {
                if (key != null && value != null) {
                    recipe.setMetadata(key, value);
                }
            });
        }
        
        System.out.println("配方创建成功: " + recipe.getRecipeId());
        return true;
    }
    
    public List<RecipeManager.ProcessRecipe> batchCreateRecipes(
            List<RecipeCreationRequest> requests) {
        List<RecipeManager.ProcessRecipe> createdRecipes = new ArrayList<>();
        
        for (RecipeCreationRequest request : requests) {
            try {
                RecipeManager.ProcessRecipe recipe = RecipeManager.createRecipe(
                    request.getRecipeName(),
                    request.getRecipeType(),
                    request.getVersion()
                );
                
                if (recipe != null) {
                    // 设置属性
                    if (request.getAttributes() != null) {
                        request.getAttributes().forEach(recipe::setMetadata);
                    }
                    
                    // 添加参数
                    if (request.getParameters() != null) {
                        request.getParameters().forEach(recipe::addParameter);
                    }
                    
                    // 添加步骤
                    if (request.getSteps() != null) {
                        request.getSteps().forEach(recipe::addStep);
                    }
                    
                    createdRecipes.add(recipe);
                    System.out.println("批量创建配方成功: " + recipe.getRecipeId());
                } else {
                    System.err.println("批量创建配方失败: " + request.getRecipeName());
                }
            } catch (Exception e) {
                System.err.println("创建配方时发生错误: " + e.getMessage());
            }
        }
        
        return createdRecipes;
    }
    
    // 配方创建请求类
    public static class RecipeCreationRequest {
        private String recipeName;
        private RecipeManager.RecipeType recipeType;
        private String version;
        private Map<String, Object> attributes;
        private List<RecipeManager.RecipeParameter> parameters;
        private List<RecipeManager.RecipeStep> steps;
        
        public RecipeCreationRequest(String recipeName, RecipeManager.RecipeType recipeType, String version) {
            this.recipeName = recipeName;
            this.recipeType = recipeType;
            this.version = version;
            this.attributes = new HashMap<>();
            this.parameters = new ArrayList<>();
            this.steps = new ArrayList<>();
        }
        
        // Getters and Setters
        public String getRecipeName() { return recipeName; }
        public void setRecipeName(String recipeName) { this.recipeName = recipeName; }
        
        public RecipeManager.RecipeType getRecipeType() { return recipeType; }
        public void setRecipeType(RecipeManager.RecipeType recipeType) { this.recipeType = recipeType; }
        
        public String getVersion() { return version; }
        public void setVersion(String version) { this.version = version; }
        
        public Map<String, Object> getAttributes() { return attributes; }
        public void setAttribute(String key, Object value) { this.attributes.put(key, value); }
        
        public List<RecipeManager.RecipeParameter> getParameters() { return parameters; }
        public void addParameter(RecipeManager.RecipeParameter parameter) { this.parameters.add(parameter); }
        
        public List<RecipeManager.RecipeStep> getSteps() { return steps; }
        public void addStep(RecipeManager.RecipeStep step) { this.steps.add(step); }
    }
}
```


### 8.2 性能优化实践

```java
public class RecipeManagerPerformanceOptimizer {
    private final Map<String, RecipeManager.ProcessRecipe> recipeCache = new ConcurrentHashMap<>();
    private final long cacheTimeout = 600000; // 10分钟
    
    public RecipeManager.ProcessRecipe getCachedRecipe(String recipeId) {
        // 检查本地缓存
        CachedRecipe cached = (CachedRecipe) recipeCache.get(recipeId);
        
        if (cached != null && !cached.isExpired()) {
            System.out.println("从本地缓存获取配方: " + recipeId);
            return cached.getRecipe();
        }
        
        // 从管理器获取
        RecipeManager.ProcessRecipe recipe = RecipeManager.loadRecipe(recipeId);
        
        // 更新本地缓存
        if (recipe != null) {
            recipeCache.put(recipeId, new CachedRecipe(recipe, System.currentTimeMillis() + cacheTimeout));
        }
        
        return recipe;
    }
    
    public void batchUpdateRecipeStatus(List<String> recipeIds, 
                                     RecipeManager.RecipeStatus newStatus,
                                     String description) {
        ExecutorService executor = Executors.newFixedThreadPool(10);
        List<Future<Boolean>> futures = new ArrayList<>();
        
        for (String recipeId : recipeIds) {
            Future<Boolean> future = executor.submit(() -> {
                try {
                    RecipeManager.ProcessRecipe recipe = RecipeManager.loadRecipe(recipeId);
                    if (recipe != null) {
                        recipe.setStatus(newStatus);
                        return RecipeManager.updateRecipe(recipe);
                    }
                    return false;
                } catch (Exception e) {
                    System.err.println("更新配方状态时发生错误: " + e.getMessage());
                    return false;
                }
            });
            futures.add(future);
        }
        
        // 等待所有更新完成
        int successCount = 0;
        for (int i = 0; i < futures.size(); i++) {
            try {
                if (futures.get(i).get(30, TimeUnit.SECONDS)) {
                    successCount++;
                }
            } catch (Exception e) {
                System.err.println("更新配方 " + recipeIds.get(i) + " 状态时发生错误: " + e.getMessage());
            }
        }
        
        executor.shutdown();
        System.out.println("批量状态更新完成: " + successCount + "/" + recipeIds.size() + " 成功");
    }
    
    // 缓存配方类
    private static class CachedRecipe {
        private final RecipeManager.ProcessRecipe recipe;
        private final long expireTime;
        
        public CachedRecipe(RecipeManager.ProcessRecipe recipe, long expireTime) {
            this.recipe = recipe;
            this.expireTime = expireTime;
        }
        
        public RecipeManager.ProcessRecipe getRecipe() { return recipe; }
        public boolean isExpired() { return System.currentTimeMillis() > expireTime; }
    }
}
```


## 9. 系统集成

### 9.1 与Web服务集成

```java
@RestController
@RequestMapping("/api/recipes")
public class RecipeManagerController {
    
    @PostMapping("/create")
    public ResponseEntity<?> createRecipe(@RequestBody RecipeCreationRequest request) {
        try {
            RecipeManager.ProcessRecipe recipe = RecipeManager.createRecipe(
                request.getRecipeName(),
                RecipeManager.RecipeType.valueOf(request.getRecipeType()),
                request.getVersion()
            );
            
            if (recipe != null) {
                // 设置属性
                if (request.getAttributes() != null) {
                    request.getAttributes().forEach((key, value) -> {
                        if (key != null && value != null) {
                            recipe.setMetadata(key, value.toString());
                        }
                    });
                }
                
                // 添加参数
                if (request.getParameters() != null) {
                    request.getParameters().forEach(paramRequest -> {
                        RecipeManager.RecipeParameter param = new RecipeManager.RecipeParameter(
                            paramRequest.getParameterId(),
                            paramRequest.getParameterName(),
                            RecipeManager.ParameterType.valueOf(paramRequest.getParameterType())
                        )
                        .setDefaultValue(paramRequest.getDefaultValue())
                        .setMinValue(paramRequest.getMinValue())
                        .setMaxValue(paramRequest.getMaxValue())
                        .setUnit(paramRequest.getUnit())
                        .setRequired(paramRequest.isRequired())
                        .setDescription(paramRequest.getDescription());
                        
                        recipe.addParameter(param);
                    });
                }
                
                return ResponseEntity.ok(convertToResponse(recipe));
            } else {
                return ResponseEntity.badRequest().body("配方创建失败");
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("服务器内部错误: " + e.getMessage());
        }
    }
    
    @GetMapping("/{recipeId}")
    public ResponseEntity<?> getRecipe(@PathVariable String recipeId) {
        try {
            RecipeManager.ProcessRecipe recipe = RecipeManager.loadRecipe(recipeId);
            
            if (recipe != null) {
                return ResponseEntity.ok(convertToResponse(recipe));
            } else {
                return ResponseEntity.notFound().build();
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("获取配方失败: " + e.getMessage());
        }
    }
    
    @PostMapping("/{recipeId}/optimize")
    public ResponseEntity<?> optimizeRecipe(@PathVariable String recipeId,
                                          @RequestBody OptimizationRequest request) {
        try {
            RecipeManager.ProcessRecipe recipe = RecipeManager.loadRecipe(recipeId);
            if (recipe == null) {
                return ResponseEntity.notFound().build();
            }
            
            RecipeManager.HistoricalData historicalData = convertToHistoricalData(request.getHistoricalData());
            RecipeManager.OptimizationAlgorithm algorithm = request.getAlgorithm() != null ? 
                RecipeManager.OptimizationAlgorithm.valueOf(request.getAlgorithm()) : 
                RecipeManager.OptimizationAlgorithm.GENETIC_ALGORITHM;
            
            RecipeManager.OptimizedParameters optimizedParams = RecipeManager.optimizeParameters(
                recipe, historicalData, algorithm
            );
            
            if (optimizedParams != null) {
                return ResponseEntity.ok(convertToResponse(optimizedParams));
            } else {
                return ResponseEntity.badRequest().body("参数优化失败");
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("参数优化失败: " + e.getMessage());
        }
    }
    
    @PostMapping("/{recipeId}/submit")
    public ResponseEntity<?> submitRecipeForApproval(@PathVariable String recipeId) {
        try {
            boolean submitted = RecipeManager.submitRecipeForApproval(
                RecipeManager.loadRecipe(recipeId)
            );
            
            if (submitted) {
                return ResponseEntity.ok("配方提交审批成功");
            } else {
                return ResponseEntity.badRequest().body("配方提交审批失败");
            }
        } catch (Exception e) {
            return ResponseEntity.status(500).body("提交审批失败: " + e.getMessage());
        }
    }
    
    // 请求和响应类
    public static class RecipeCreationRequest {
        private String recipeName;
        private String recipeType;
        private String version;
        private Map<String, Object> attributes;
        private List<RecipeParameterRequest> parameters;
        
        // Getters and Setters
        public String getRecipeName() { return recipeName; }
        public void setRecipeName(String recipeName) { this.recipeName = recipeName; }
        
        public String getRecipeType() { return recipeType; }
        public void setRecipeType(String recipeType) { this.recipeType = recipeType; }
        
        public String getVersion() { return version; }
        public void setVersion(String version) { this.version = version; }
        
        public Map<String, Object> getAttributes() { return attributes; }
        public void setAttributes(Map<String, Object> attributes) { this.attributes = attributes; }
        
        public List<RecipeParameterRequest> getParameters() { return parameters; }
        public void setParameters(List<RecipeParameterRequest> parameters) { this.parameters = parameters; }
    }
    
    public static class RecipeParameterRequest {
        private String parameterId;
        private String parameterName;
        private String parameterType;
        private Object defaultValue;
        private Object minValue;
        private Object maxValue;
        private String unit;
        private boolean required;
        private String description;
        
        // Getters and Setters
        public String getParameterId() { return parameterId; }
        public void setParameterId(String parameterId) { this.parameterId = parameterId; }
        
        public String getParameterName() { return parameterName; }
        public void setParameterName(String parameterName) { this.parameterName = parameterName; }
        
        public String getParameterType() { return parameterType; }
        public void setParameterType(String parameterType) { this.parameterType = parameterType; }
        
        public Object getDefaultValue() { return defaultValue; }
        public void setDefaultValue(Object defaultValue) { this.defaultValue = defaultValue; }
        
        public Object getMinValue() { return minValue; }
        public void setMinValue(Object minValue) { this.minValue = minValue; }
        
        public Object getMaxValue() { return maxValue; }
        public void setMaxValue(Object maxValue) { this.maxValue = maxValue; }
        
        public String getUnit() { return unit; }
        public void setUnit(String unit) { this.unit = unit; }
        
        public boolean isRequired() { return required; }
        public void setRequired(boolean required) { this.required = required; }
        
        public String getDescription() { return description; }
        public void setDescription(String description) { this.description = description; }
    }
    
    public static class OptimizationRequest {
        private HistoricalDataRequest historicalData;
        private String algorithm;
        
        // Getters and Setters
        public HistoricalDataRequest getHistoricalData() { return historicalData; }
        public void setHistoricalData(HistoricalDataRequest historicalData) { this.historicalData = historicalData; }
        
        public String getAlgorithm() { return algorithm; }
        public void setAlgorithm(String algorithm) { this.algorithm = algorithm; }
    }
    
    public static class HistoricalDataRequest {
        private List<DataPointRequest> dataPoints;
        private LocalDateTime startTime;
        private LocalDateTime endTime;
        private String productId;
        
        // Getters and Setters
        public List<DataPointRequest> getDataPoints() { return dataPoints; }
        public void setDataPoints(List<DataPointRequest> dataPoints) { this.dataPoints = dataPoints; }
        
        public LocalDateTime getStartTime() { return startTime; }
        public void setStartTime(LocalDateTime startTime) { this.startTime = startTime; }
        
        public LocalDateTime getEndTime() { return endTime; }
        public void setEndTime(LocalDateTime endTime) { this.endTime = endTime; }
        
        public String getProductId() { return productId; }
        public void setProductId(String productId) { this.productId = productId; }
    }
    
    public static class DataPointRequest {
        private Map<String, Object> parameters;
        private double qualityScore;
        private LocalDateTime timestamp;
        
        // Getters and Setters
        public Map<String, Object> getParameters() { return parameters; }
        public void setParameters(Map<String, Object> parameters) { this.parameters = parameters; }
        
        public double getQualityScore() { return qualityScore; }
        public void setQualityScore(double qualityScore) { this.qualityScore = qualityScore; }
        
        public LocalDateTime getTimestamp() { return timestamp; }
        public void setTimestamp(LocalDateTime timestamp) { this.timestamp = timestamp; }
    }
    
    // 转换方法
    private Object convertToResponse(RecipeManager.ProcessRecipe recipe) {
        // 实现配方信息到响应对象的转换
        return new Object();
    }
    
    private Object convertToResponse(RecipeManager.OptimizedParameters optimizedParams) {
        // 实现优化参数到响应对象的转换
        return new Object();
    }
    
    private RecipeManager.HistoricalData convertToHistoricalData(HistoricalDataRequest request) {
        // 实现历史数据请求到HistoricalData对象的转换
        List<RecipeManager.DataPoint> dataPoints = new ArrayList<>();
        if (request.getDataPoints() != null) {
            for (DataPointRequest dpRequest : request.getDataPoints()) {
                dataPoints.add(new RecipeManager.DataPoint(
                    dpRequest.getParameters(),
                    dpRequest.getQualityScore(),
                    dpRequest.getTimestamp()
                ));
            }
        }
        
        return new RecipeManager.HistoricalData(
            dataPoints,
            request.getStartTime(),
            request.getEndTime(),
            request.getProductId()
        );
    }
}
```


### 9.2 与调度系统集成

```java
@Component
public class ScheduledRecipeTasks {
    
    // 每天凌晨3点执行配方状态检查
    @Scheduled(cron = "0 0 3 * * ?")
    public void checkRecipeStatus() {
        System.out.println("开始执行配方状态检查任务...");
        
        try {
            // 查询需要检查的配方（如长期未更新的草稿配方）
            RecipeManager.RecipeQuery query = new RecipeManager.RecipeQuery()
                .setStatus(RecipeManager.RecipeStatus.DRAFT)
                .setStartDate(LocalDateTime.now().minusMonths(3)); // 3个月前创建的草稿
            
            List<RecipeManager.ProcessRecipe> draftRecipes = RecipeManager.queryRecipes(query);
            
            int archivedCount = 0;
            for (RecipeManager.ProcessRecipe recipe : draftRecipes) {
                // 将长期未处理的草稿配方归档
                recipe.setStatus(RecipeManager.RecipeStatus.ARCHIVED);
                if (RecipeManager.updateRecipe(recipe)) {
                    archivedCount++;
                }
            }
            
            System.out.println("配方状态检查完成，归档了 " + archivedCount + " 个草稿配方");
        } catch (Exception e) {
            System.err.println("配方状态检查任务失败: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    // 每小时检查配方审批超时
    @Scheduled(fixedRate = 3600000) // 1小时
    public void checkApprovalTimeouts() {
        System.out.println("开始检查配方审批超时...");
        
        try {
            // 查询审批中的配方
            RecipeManager.RecipeQuery query = new RecipeManager.RecipeQuery()
                .setStatus(RecipeManager.RecipeStatus.UNDER_REVIEW);
            
            List<RecipeManager.ProcessRecipe> reviewRecipes = RecipeManager.queryRecipes(query);
            
            LocalDateTime timeoutThreshold = LocalDateTime.now().minusDays(7); // 7天超时
            
            int timeoutCount = 0;
            for (RecipeManager.ProcessRecipe recipe : reviewRecipes) {
                // 检查审批是否超时
                if (recipe.getLastModifiedTime().isBefore(timeoutThreshold)) {
                    // 自动拒绝超时的审批
                    if (RecipeManager.rejectRecipe(recipe.getRecipeId(), "系统", "审批超时自动拒绝")) {
                        timeoutCount++;
                        System.out.println("自动拒绝超时配方: " + recipe.getRecipeId());
                    }
                }
            }
            
            if (timeoutCount > 0) {
                System.out.println("发现并处理了 " + timeoutCount + " 个超时审批");
            }
        } catch (Exception e) {
            System.err.println("配方审批超时检查失败: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    // 每周生成配方统计报告
    @Scheduled(cron = "0 0 4 * * MON") // 每周一凌晨4点
    public void generateWeeklyRecipeReport() {
        System.out.println("开始生成周配方统计报告...");
        
        try {
            LocalDateTime weekAgo = LocalDateTime.now().minusWeeks(1);
            
            // 查询上周的配方数据
            RecipeManager.RecipeQuery query = new RecipeManager.RecipeQuery()
                .setStartDate(weekAgo);
            
            List<RecipeManager.ProcessRecipe> weeklyRecipes = RecipeManager.queryRecipes(query);
            
            // 生成统计报告
            generateRecipeStatisticsReport(weeklyRecipes, weekAgo, LocalDateTime.now());
            
            System.out.println("周配方统计报告生成完成");
        } catch (Exception e) {
            System.err.println("周配方统计报告生成失败: " + e.getMessage());
            e.printStackTrace();
        }
    }
    
    private void generateRecipeStatisticsReport(List<RecipeManager.ProcessRecipe> recipes,
                                             LocalDateTime startTime, 
                                             LocalDateTime endTime) {
        // 生成配方统计报告
        System.out.println("生成配方统计报告，时间范围: " + startTime + " 到 " + endTime);
        System.out.println("  配方总数: " + recipes.size());
        
        // 按类型统计
        Map<RecipeManager.RecipeType, Long> typeCount = recipes.stream()
            .collect(Collectors.groupingBy(
                RecipeManager.ProcessRecipe::getRecipeType,
                Collectors.counting()
            ));
        
        System.out.println("  类型分布:");
        typeCount.forEach((type, count) -> 
            System.out.println("    " + type.getChineseName() + ": " + count));
        
        // 按状态统计
        Map<RecipeManager.RecipeStatus, Long> statusCount = recipes.stream()
            .collect(Collectors.groupingBy(
                RecipeManager.ProcessRecipe::getStatus,
                Collectors.counting()
            ));
        
        System.out.println("  状态分布:");
        statusCount.forEach((status, count) -> 
            System.out.println("    " + status.getDescription() + ": " + count));
    }
}
```


这个使用说明文档涵盖了 [RecipeManager](file://E:\dossier\others\im-common\src\main\java\com\qtech\im\semiconductor\process\recipe\RecipeManager.java#L34-L1771) 的主要功能和使用方法，可以帮助开发者快速上手并正确使用该工艺配方管理工具类。